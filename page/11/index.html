<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>They Call Me Mister James</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This is the blog of James Chambers, a senior developer on the .NET stack">
<meta property="og:type" content="website">
<meta property="og:title" content="They Call Me Mister James">
<meta property="og:url" content="http://jameschambers.com/page/11/index.html">
<meta property="og:site_name" content="They Call Me Mister James">
<meta property="og:description" content="This is the blog of James Chambers, a senior developer on the .NET stack">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="They Call Me Mister James">
<meta name="twitter:description" content="This is the blog of James Chambers, a senior developer on the .NET stack">
<meta name="twitter:creator" content="@CanadianJames">
<meta name="twitter:site" content="CanadianJames">
  
  
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="content/avatar.png">
  
  
 <link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
 <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>


  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-2868185-6', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  

  
  <script src="//load.sumome.com/" data-sumo-site-id="34f480920bcf5ea13ec1605be65d32e86be89fb7177416fb68c2d2f1939aaa04" async="async"></script>
</head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo"><i class="logo" style="background-image: url(/content/logo_round.png)"></i><span class="site-title">They Call Me Mister James</span></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/.">Home</a>
        
          <a class="main-nav-link" href="/about/bootstrapping-mvc.html">Boostrapping MVC</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">Testimonials</a>
        
          <a class="main-nav-link" href="/about/genfu.html">GenFu</a>
        
        <a class="main-nav-link main-nav-link-highlight" href="https://hireme.jameschambers.com" target="_blank">Hire Me</a>
      </nav>
      
        <nav id="sub-nav">
          <div class="profile" id="profile-nav">
            <a id="profile-anchor" href="javascript:;"><img class="avatar" src="/content/avatar.png"><i class="fa fa-caret-down"></i></a>
          </div>
        </nav>
      
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="http://jameschambers.com"></form>
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
        
          <td><a class="main-nav-link" href="/.">Home</a></td>
        
          <td><a class="main-nav-link" href="/about/bootstrapping-mvc.html">Boostrapping MVC</a></td>
        
          <td><a class="main-nav-link" href="/archives">Archives</a></td>
        
          <td><a class="main-nav-link" href="/about">Testimonials</a></td>
        
          <td><a class="main-nav-link" href="/about/genfu.html">GenFu</a></td>
        
        <td>
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://jameschambers.com"></form>
        </td>
      </tr>
    </table>
  </div>
</header>

    <div class="outer">
      
        <aside id="profile">
  <div class="inner profile-inner">
    <div class="base-info profile-block">
      <h2 id="name">James Chambers</h2>
      <h3 id="title">Husband, Father, Mentor, Humanitarian &amp; Software Developer</h3>
      <span id="location"><i class="fa fa-map-marker"></i>Canada</span>
      <a id="follow" href="https://twitter.com/canadianjames">FOLLOW</a>
    </div>

    
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
          
          <td><a href="/CanadianJames" target="_blank" title="twitter"><i class="fa fa-twitter"></i></a></td>
          
          <td><a href="http://github.com/MisterJames" target="_blank" title="github"><i class="fa fa-github"></i></a></td>
          
          <td><a href="/atom.xml" target="_blank" title="rss"><i class="fa fa-rss"></i></a></td>
          
          <td><a href="https://ca.linkedin.com/in/canadianjames" target="_blank" title="linkedin"><i class="fa fa-linkedin"></i></a></td>
          
          <td><a href="https://www.youtube.com/user/CodingMisterJames/" target="_blank" title="youtube"><i class="fa fa-youtube"></i></a></td>
          
        </tr>
      </table>
    </div>
    

    <div class="base-info profile-block">
        <a href="http://aspnetmonsters.com" target="_blank"><img src="/content/monster-james.png"></a>      
    </div>

    <div class="base-info profile-block">
        <a href="https://leanpub.com/bootstrappingmvc" onclick="_gaq.push(['_trackEvent', 'outbound-widget', 'https://leanpub.com/bootstrappingmvc', '\n\n']);">
            <img src="https://s3.amazonaws.com/titlepages.leanpub.com/bootstrappingmvc/medium?1425560219" scale="0">
        </a>
    </div>
        
    
  </div>
</aside>

      
      <section id="main">
      <article id="post-day-24-storing-user-profile-information" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/day-24-storing-user-profile-information/">Day 24: Storing User Profile Information</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2014/06/day-24-storing-user-profile-information/">
      <time datetime="2014-06-30T15:42:00.000Z" itemprop="datePublished">2014-06-30</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Code-Dive/">Code Dive</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>This is an installment in a 30 day series on Bootstrap and the MVC Framework. To see more, check out <a href="http://jameschambers.com/2014/06/day-0-boothstrapping-mvc-for-the-next-30-days/">Day 0 for an index</a>.</p>
<p>Session is an attractive and oft-used mechanism for storing user profile data. It’s freely available and has been around forever. But session state and logged-in user identity, while they may seem closely related, do not operate on the same lifecycle and sensitive data, personal data, could get “leaked out”.</p>
<p>And hey…this post assumes you’ve been following along with the series and you have already signed in at least once with a registered user.</p>
<h2 id="A_Better_Place_to_Store_User_Profile_Data"><a href="#A_Better_Place_to_Store_User_Profile_Data" class="headerlink" title="A Better Place to Store User Profile Data"></a>A Better Place to Store User Profile Data</h2><p>In <a href="http://jameschambers.com/2014/06/day-23-choosing-your-own-look-and-feel/">yesterday’s article</a> we penned in the user’s choice of Bootstrap Theme and stored their selection in the Session object. Brock Allen wrote a great post a couple years back on why this kind of thing isn’t a great approach. The things that concern us most are that:</p>
<ul>
<li>By default, session isn’t durable and doesn’t scale  </li><li>Even if we move to a more durable session management approach, there’s no persistence of session data and yet we’re making network hops  </li><li>Session isn’t tied to users signing in or out </li>
</ul>
<p>So, today, we’re going to fix that Session access with a permanent, more reliable and secure approach.</p>
<h2 id="Extending_the_User_Profile_Data"><a href="#Extending_the_User_Profile_Data" class="headerlink" title="Extending the User Profile Data"></a>Extending the User Profile Data</h2><p>Since you’ve already <a href="http://jameschambers.com/2014/06/day-22-sprucing-up-identity-for-logged-in-users/">created an account</a>, you technically have some profile information already stored in your site’s database. We’re going to leverage the identity infrastructure of our project and extend the class that keeps track of our data, adding in the user’s selected theme. In your Solution Explorer, locate the ApplicationUser class under Models. The easiest way is usually just through the search box at the top:</p>
<p><a href="https://jcblogimages.blob.core.windows.net/img/2014/06/image42.png" target="_blank" rel="external"><img src="https://jcblogimages.blob.core.windows.net/img/2014/06/image_thumb21.png" alt="image" title="image"></a></p>
<p>Add the following property to your ApplicationUser class:</p>
<p><pre class="csharpcode"><span class="kwrd">public</span> <span class="kwrd">string</span> CssTheme { get; set; }</pre></p>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>Something to keep in mind: we’re going to be modifying a class that participates in Entity Framework persistence, as managed by the Asp.Net Identity libraries. This is handy, but not free. Because we’re changing essentially the schema of a table, we’ll also need to enable and create a migration from the Package Manager Console:</p>
<p><pre class="csharpcode">Enable-Migrations -ContextTypeName SimpleSite.Models.ApplicationDbContext -MigrationsDirectory Migrations\Identity<br>Add-Migration CssTheme -ConfigurationTypeName SimpleSite.Migrations.Identity.Configuration</pre></p>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>Note that we’ve got a pre-existing migration on our site, <strong>so we need to now be more specific</strong> and explicitly name the Configuration type. Also, in enabling the migrations, I added the MigrationsDirectory folder for the DbContext, so that our identity-related migrations would be in a sub-folder. </p>
<p>The Entity Framework created the appropriate classes for me to track DbContext-specific settings and the migration that I needed to update the database, but those are just the classes, nothing’s changed in the DB yet. That all needs to be followed by an update to our database like so:</p>
<p><pre class="csharpcode">Update-Database -ConfigurationTypeName SimpleSite.Migrations.Identity.Configuration</pre></p>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>We can now store the data we need to, we just need a way to be able to stuff it in there.</p>
<h2 id="Updating_our_Controller"><a href="#Updating_our_Controller" class="headerlink" title="Updating our Controller"></a>Updating our Controller</h2><p>Since we’re now targeting a user managed from the Identity libraries we’re going to wipe out the code that writes to session and instead use the relevant classes to locate the user profile and update it. Head over to ProfileController.cs (in Helpers) and replace the call to Session with the following:</p>
<p><pre class="csharpcode">var userStore = <span class="kwrd">new</span> UserStore&lt;ApplicationUser&gt;(<span class="kwrd">new</span> ApplicationDbContext());<br>var manager = <span class="kwrd">new</span> UserManager&lt;ApplicationUser&gt;(userStore);<br>var user = manager.FindById(User.Identity.GetUserId());<br>user.CssTheme = themename;<br>manager.Update(user);</pre></p>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>We resolve the user through a UserManager, and the manager needs a UserStore to locate it’s data. We can then set the CssTheme and update the user through the manager. ApplicationUser and ApplicationDbContext are just the names of the types that were automatically created for you through the project template.</p>
<p>It’s only 5 lines of code to access and update a property, but you can see how there must be a better solution to all this than having to write this code all the time. Some day I bet a post will pop up on that…</p>
<h2 id="Updating_our_Layout"><a href="#Updating_our_Layout" class="headerlink" title="Updating our Layout"></a>Updating our Layout</h2><p>Open up _Layout.cshtml (in Shared\Views) and update the code that resolves the correct style bundle. We’re going to use a similar approach to what we did in the controller to find the user and property, and we’ll handle the null case a little differently than we were previously as well by setting the default in advance. </p>
<p><pre class="csharpcode">@{<br>    var theme = Bootstrap.Theme.Stock;<br>    <span class="kwrd">if</span> (User.Identity.IsAuthenticated)<br>    {<br>        var userStore = <span class="kwrd">new</span> UserStore&lt;ApplicationUser&gt;(<span class="kwrd">new</span> ApplicationDbContext());<br>        var manager = <span class="kwrd">new</span> UserManager&lt;ApplicationUser&gt;(userStore);<br>        var user = manager.FindById(User.Identity.GetUserId());<br>        theme = user.CssTheme ?? theme;<br>    }<br>    @Styles.Render(Bootstrap.Bundle(theme))<br>}</pre></p>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>Our other line of code – to actually render the bundle – will remain the same, as you can see at the bottom.</p>
<h2 id="Wait_2C_What_Did_We_Actually_Do_Again_3F"><a href="#Wait_2C_What_Did_We_Actually_Do_Again_3F" class="headerlink" title="Wait, What Did We Actually Do Again?"></a>Wait, What Did We Actually Do Again?</h2><p>I know, I know, it’s hard to put time into something when it seems that nothing really changed. Our functionality is identical and users still have the same options as they did before.</p>
<p><a href="https://jcblogimages.blob.core.windows.net/img/2014/06/image43.png" target="_blank" rel="external"><img src="https://jcblogimages.blob.core.windows.net/img/2014/06/image_thumb22.png" alt="image" title="image"></a></p>
<p>But technically our solution is a little more sound.&nbsp; Here’s what we did again as a bit of a recap:</p>
<ul>
<li>We added a CssTheme property to our ApplicationUser class</li>
<li>We enabled migrations on our ApplicationDbContext, using a specify folder for our identity migrations</li>
<li>We added a migration to accommodate our new CssTheme property</li>
<li>We updated our controller to use the Identity objects instead of session</li>
<li>We refactored our _Layout to get the theme of choice from the user’s profile information</li>
</ul>
<h2 id="Next_Steps"><a href="#Next_Steps" class="headerlink" title="Next Steps"></a>Next Steps</h2><p>For brownie points here, one could likely go to the “manage” bits (under Controllers\AccountController and Views\Account) and allow the user to make a theme selection from there. It’s likely a better home than continuously being available from the home page.</p>
<p>Hang on a sec, though…if we’ve got a place to store information about <em>specific</em> users now, why don’t we revisit our code that puts up those lovely notification icons in the navbar?</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jameschambers.com/2014/06/day-24-storing-user-profile-information/" data-id="civiom2ht00jabwyydmtec060" class="article-share-link">Share</a>
      
        <a href="http://jameschambers.com/2014/06/day-24-storing-user-profile-information/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/30DaysMvcBootstrap/">30DaysMvcBootstrap</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Asp-Net-MVC/">Asp.Net MVC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC/">MVC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC5/">MVC5</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-day-23-choosing-your-own-look-and-feel" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/day-23-choosing-your-own-look-and-feel/">Day 23: Choosing Your Own Look-And-Feel</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2014/06/day-23-choosing-your-own-look-and-feel/">
      <time datetime="2014-06-29T17:28:00.000Z" itemprop="datePublished">2014-06-29</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Code-Dive/">Code Dive</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>This is an installment in a 30 day series on Bootstrap and the MVC Framework. To see more, check out <a href="http://jameschambers.com/2014/06/day-0-boothstrapping-mvc-for-the-next-30-days/">Day 0 for an index</a>.</p>
<p>Here’s the thing: everybody’s site is going to look the same if everybody’s site uses Bootstrap, right? Well, if we did that to users, we’d sure be missing the point as developers, and for two key reasons: 1) With the LESS and SASS source it’s easy to customize, and 2) Because it’s easy to customize, there’s already people creating all kinds of alternate themes for Bootstrap.</p>
<p>So, we aren’t headed down a slippery slope here, we just need to make a little effort to give our users some unique looking sites.&nbsp; Other posts will show you how to replace the Bootstrap theme, but this one will show you how to let your users choose from a list you’ve pre-built.</p>
<h2 id="Download_a_Free_Substitute"><a href="#Download_a_Free_Substitute" class="headerlink" title="Download a Free Substitute"></a>Download a Free Substitute</h2><p>There are some great, free alternatives located at <a href="http://bootswatch.com/" target="_blank" rel="external">Bootswatch.com</a>. So, start there and pick one or two to download, I chose Amelia and Darkly. We need to create a folder structure to organize our themes, and move the CSS into those folders. Mine ended up working like this:</p>
<p><img src="https://jcblogimages.blob.core.windows.net/img/2014/06/image40.png" alt="image" title="image"></p>
<p>Note that I also pushed a copy of the stock CSS for bootstrap into this structure. This allows us to simplify our code for theme switching, allowing users to pick the base theme if they like.</p>
<p><strong>Shameless plug</strong>: If you’re looking for professionally designed themes to replace your palette, you can help out this blogger (me!) by purchasing one over at <a href="https://wrapbootstrap.com/?ref=BootstrapOnMvc" target="_blank" rel="external">{wrap}bootstrap</a>. They have a selection of great looking Bootstrap themes. A very affordable alternative to taking the time to create your own theme.</p>
<h2 id="Creating_a_Helper_Class"><a href="#Creating_a_Helper_Class" class="headerlink" title="Creating a Helper Class"></a>Creating a Helper Class</h2><p>Next, we create a class called Bootstrap.cs (I put mine in \Helpers) so that we can programmatically work with the themes. This class is responsible for presenting the list of supported themes and resolving the path to them when we try to load the bundles.</p>
<pre class="csharpcode"><span class="kwrd">public</span> <span class="kwrd">class</span> Bootstrap
{
    <span class="kwrd">public</span> <span class="kwrd">const</span> <span class="kwrd">string</span> BundleBase = <span class="str">"~/Content/css/"</span>;

    <span class="kwrd">public</span> <span class="kwrd">class</span> Theme
    {
        <span class="kwrd">public</span> <span class="kwrd">const</span> <span class="kwrd">string</span> Stock = <span class="str">"Stock"</span>;
        <span class="kwrd">public</span> <span class="kwrd">const</span> <span class="kwrd">string</span> Amelia = <span class="str">"Amelia"</span>;
        <span class="kwrd">public</span> <span class="kwrd">const</span> <span class="kwrd">string</span> Darkly = <span class="str">"Darkly"</span>;
    }

    <span class="kwrd">public</span> <span class="kwrd">static</span> HashSet&lt;<span class="kwrd">string</span>&gt; Themes = <span class="kwrd">new</span> HashSet&lt;<span class="kwrd">string</span>&gt;
    {
        Theme.Stock,
        Theme.Amelia,
        Theme.Darkly
    };

    <span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">string</span> Bundle(<span class="kwrd">string</span> themename)
    {
        <span class="kwrd">return</span> BundleBase + themename;
    }
}</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

This is a simple class, but it prevents us from duplicating code all over the place or unnecessary spelling mistakes.

The other nice thing is that if you choose to add another theme to your project, you will just have to modify this one file and the rest will fall into place.&nbsp; For that to happen, we’ll need to modify our startup to generate all the appropriate bundles.

## Updating Our Startup Bits

Head into BundleConfig.cs (inside of \App_Startup) and replace the code that creates the Bootstrap bundle with the following:
<pre class="csharpcode"><span class="kwrd">foreach</span> (var theme <span class="kwrd">in</span> Bootstrap.Themes)
{
    var stylePath = <span class="kwrd">string</span>.Format(<span class="str">"~/Content/Themes/{0}/bootstrap.css"</span>, theme);

    bundles.Add(<span class="kwrd">new</span> StyleBundle(Bootstrap.Bundle(theme)).Include(
                stylePath,
                <span class="str">"~/Content/bootstrap.custom.css"</span>,
                <span class="str">"~/Content/site.css"</span>));
}</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

We’re simply looping over that handle collection we created so that we could generate a bundle for every installed theme.&nbsp; We always want all the themes – startup is only run at as the application starts, so we need them all there – as different users may wish to select different themes.

## Making Our Layout “Themeable”

What we really need to do here is just a quick update to figure out the user’s current theme, and then figure out what the correct bundle to use is.
<pre class="csharpcode">@{
    var theme = Session[<span class="str">"CssTheme"</span>] <span class="kwrd">as</span> <span class="kwrd">string</span> ?? Bootstrap.Theme.Stock;
}
@Styles.Render(Bootstrap.Bundle(theme))</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

I’m using Session for now, but I’ll explain why in a bit that is bad idea. ![Smile](https://jcblogimages.blob.core.windows.net/img/2014/06/wlEmoticon-smile3.png)

Note that, at this point, you could set that theme default – right now set to Bootstrap.Theme.Stock – to whichever theme you like and run your app. The mechanics of building the bundle and the class to resolve it are all in place.

## Letting the User Choose a Theme

Once again we’re going to revisit the _LoginPartial.cshtml file (in Views\Shared). In this round, we’re going to update the text that shows the logged in user’s email address (which, by default, is also their username). The LI for the username is now going to be a dropdown box in the navbar.
<pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">li</span> <span class="attr">class</span><span class="kwrd">="dropdown"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">a</span> <span class="attr">href</span><span class="kwrd">="#"</span> <span class="attr">class</span><span class="kwrd">="dropdown-toggle"</span> <span class="attr">data-toggle</span><span class="kwrd">="dropdown"</span><span class="kwrd">&gt;</span>Hello @username! <span class="kwrd">&lt;</span><span class="html">span</span> <span class="attr">class</span><span class="kwrd">="caret"</span><span class="kwrd">&gt;&lt;/</span><span class="html">span</span><span class="kwrd">&gt;&lt;/</span><span class="html">a</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">ul</span> <span class="attr">class</span><span class="kwrd">="dropdown-menu"</span> <span class="attr">role</span><span class="kwrd">="menu"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">li</span><span class="kwrd">&gt;</span>
            @Html.ActionLink("Manage Account", "Manage", "Account", routeValues: null, htmlAttributes: new { title = "Manage" })
        <span class="kwrd">&lt;/</span><span class="html">li</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">li</span> <span class="attr">class</span><span class="kwrd">="divider"</span><span class="kwrd">&gt;&lt;/</span><span class="html">li</span><span class="kwrd">&gt;</span>
        @foreach (var theme in Bootstrap.Themes)
        {
            <span class="kwrd">&lt;</span><span class="html">li</span><span class="kwrd">&gt;&lt;</span><span class="html">a</span> <span class="attr">href</span><span class="kwrd">="@Url.Action("</span><span class="attr">ChangeTheme</span><span class="kwrd">", "</span><span class="attr">Profile</span><span class="kwrd">", new { themename = theme})"</span><span class="kwrd">&gt;</span>@theme<span class="kwrd">&lt;/</span><span class="html">a</span><span class="kwrd">&gt;&lt;/</span><span class="html">li</span><span class="kwrd">&gt;</span>
        }
    <span class="kwrd">&lt;/</span><span class="html">ul</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">li</span><span class="kwrd">&gt;</span>
</pre>

<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
I’ve taken that LI that was there – all it had was the user name, which was a link to Manage Account – and replaced it will all of the above code. We put in a divider and iterate over the list of known themes.&nbsp; Each will be a link to a “ChangeTheme” action on the “Profile” controller.

## Adding our New Profile Controller

Throw ProfileController.cs in your \Controllers directory with the following, lone action in the class:
<pre class="csharpcode"><span class="kwrd">public</span> ActionResult ChangeTheme(<span class="kwrd">string</span> themename)
{
    Session[<span class="str">"CssTheme"</span>] = themename;
    <span class="kwrd">if</span> (Request.UrlReferrer != <span class="kwrd">null</span>)
    {
        var returnUrl = Request.UrlReferrer.ToString();
        <span class="kwrd">return</span> <span class="kwrd">new</span> RedirectResult(returnUrl);
    }
    <span class="kwrd">return</span> RedirectToAction(<span class="str">"Index"</span>, <span class="str">"Home"</span>);
}</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>If we have a referring URL we can push the user back to the same page, otherwise we ship them home. The preference of theme is set in the Session.</p>
<p>And there you have it: users can now pick their own theme on your site:</p>
<p><img src="https://jcblogimages.blob.core.windows.net/img/2014/06/image41.png" alt="image" title="image"></p>
<h2 id="Next_Steps"><a href="#Next_Steps" class="headerlink" title="Next Steps"></a>Next Steps</h2><p>This data doesn’t really belong in the user’s session…whenever the app pool is recycled or the website or IIS is restarted or their session expires they will lose this choice. Even worse, session and Identity aren’t on the same lifecycle, so when they log out the session persists and they’ll still see the theme they chose when they logged in.</p>
<p>So, where should it be stored? Tune in next time as we answer this question and more. <img src="https://jcblogimages.blob.core.windows.net/img/2014/06/wlEmoticon-smilewithtongueout.png" alt="Smile with tongue out"></p>
<p>Happy coding! <img src="https://jcblogimages.blob.core.windows.net/img/2014/06/wlEmoticon-smile3.png" alt="Smile"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jameschambers.com/2014/06/day-23-choosing-your-own-look-and-feel/" data-id="civiom2hw00jgbwyytr3o9p0q" class="article-share-link">Share</a>
      
        <a href="http://jameschambers.com/2014/06/day-23-choosing-your-own-look-and-feel/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/30DaysMvcBootstrap/">30DaysMvcBootstrap</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Asp-Net-MVC/">Asp.Net MVC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC/">MVC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC5/">MVC5</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-day-22-sprucing-up-identity-for-logged-in-users" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/day-22-sprucing-up-identity-for-logged-in-users/">Day 22: Sprucing up Identity for Logged In Users</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2014/06/day-22-sprucing-up-identity-for-logged-in-users/">
      <time datetime="2014-06-28T08:37:00.000Z" itemprop="datePublished">2014-06-28</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Code-Dive/">Code Dive</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>This is an installment in a 30 day series on Bootstrap and the MVC Framework. To see more, check out <a href="http://jameschambers.com/2014/06/day-0-boothstrapping-mvc-for-the-next-30-days/">Day 0 for an index</a>.</p>
<p>Typically you wouldn’t want the entirety of the internet adding and editing records at will without some form of authentication and authorization so that you can keep track of who’s editing your data, or so that your users can keep track of their own.</p>
<p>So, let’s continue with our project and build out some identity capabilities.</p>
<h2 id="Okay_2C_I_u2019m_Kidding-_Just_Press_F5_21"><a href="#Okay_2C_I_u2019m_Kidding-_Just_Press_F5_21" class="headerlink" title="Okay, I’m Kidding. Just Press F5!"></a>Okay, I’m Kidding. Just Press F5!</h2><p>Great work, you’re all done!</p>
<p>As most folks are well aware, the default templates for Asp.Net applications now ship with a sample account administration implementation (reasonably good ones, at that). Users are able to register and log in using pre-built models, controllers and views. You can easily extend the template with 3rd party login capabilities, allowing folks with Microsoft, Facebook or Google accounts (and, and, and…) to log into your site as well. We’ve now got substantial improvements to identity management overall, with things like two-factor authentication, reductions in the leaky abstractions we’ve lived with, better testability, more flexibility in storage options, and more.</p>
<p>If you’re not familiar with these bits, it’s worth having a look, <strong>but this is a topic already well covered</strong>. Believe me, these are worth the reads:</p>
<ul>
<li>The Asp.Net Identity <a href="http://www.asp.net/identity" target="_blank" rel="external">web site</a></li>
<li>A <a href="http://www.asp.net/identity/overview/getting-started/introduction-to-aspnet-identity" target="_blank" rel="external">background article on Identity</a> by the Asp.Net team</li>
<li>Two-Factor <a href="http://www.asp.net/identity/overview/features-api/two-factor-authentication-using-sms-and-email-with-aspnet-identity" target="_blank" rel="external">authentication</a> with SMS</li>
<li>Using <a href="http://www.asp.net/mvc/tutorials/mvc-5/create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on" target="_blank" rel="external">third-party authentication providers</a> on your site (Facebook, Twitter, Google, LinkedIn) </li>
</ul>
<p>But we’re here to do Bootstrappy things, right? So let’s spruce up that top bar a little for our logged in users with some MVC bits we build (HTML helpers) and some Bootstrap bits (image classes) that will take our site up a level.</p>
<h2 id="Bootstrap_Image_Classes"><a href="#Bootstrap_Image_Classes" class="headerlink" title="Bootstrap Image Classes"></a>Bootstrap Image Classes</h2><p>The CSS library gives us a few easy-to-use helpers to make our images look consistent. Here’s a sample from the <a href="http://getbootstrap.com/css/#images" target="_blank" rel="external">Bootstrap site</a>:</p>
<p><img src="https://jcblogimages.blob.core.windows.net/img/2014/06/image38.png" alt="image" title="image"></p>
<p>The classes are as follows:</p>
<ul>
<li>img-rounded – provides rounded corners to your rectangular images</li>
<li>img-circle – turns any image into a circle</li>
<li>img-thumbnail – makes your image look like a little Polaroid of itself </li>
</ul>
<h2 id="Making_Members_Feel_Welcome"><a href="#Making_Members_Feel_Welcome" class="headerlink" title="Making Members Feel Welcome"></a>Making Members Feel Welcome</h2><p>Today we’re just going to add a little touch to the navbar that our logged in users will see, keying in off of the default implementation of the Identity providers.&nbsp; We’ll head in that direction by extending our HtmlHelper that generates Gravatar images, as we need to add a property for a CSS class to give us a nice round face on the page.&nbsp; But first, we’ll have to add the following line of code to the GravatarOptions class:</p>
<pre class="csharpcode"><span class="kwrd">public</span> <span class="kwrd">string</span> CssClass { get; set; }</pre>

<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>
We’ll need to add that to the tag, so let’s revist the GravatarImage, likely located in the Helpers folder, to check for a value and add it to the tag if present. The full method should now look like this:
<pre class="csharpcode"><span class="kwrd">public</span> <span class="kwrd">static</span> HtmlString GravatarImage(<span class="kwrd">this</span> HtmlHelper htmlHelper, <span class="kwrd">string</span> emailAddress, GravatarOptions options = <span class="kwrd">null</span>)
{
    <span class="kwrd">if</span> (options == <span class="kwrd">null</span>)
        options = GravatarOptions.GetDefaults();

    var imgTag = <span class="kwrd">new</span> TagBuilder(<span class="str">"img"</span>);

    emailAddress = <span class="kwrd">string</span>.IsNullOrEmpty(emailAddress) ? <span class="kwrd">string</span>.Empty : emailAddress.Trim().ToLower();

    <span class="rem">// &lt;-- adding support for CSS</span>
    <span class="kwrd">if</span> (!<span class="kwrd">string</span>.IsNullOrEmpty(options.CssClass))
    {
        imgTag.AddCssClass(options.CssClass);
    }
    <span class="rem">// adding support for CSS  --&gt;</span>

    imgTag.Attributes.Add(<span class="str">"src"</span>,
        <span class="kwrd">string</span>.Format(<span class="str">"http://www.gravatar.com/avatar/{0}?s={1}{2}{3}"</span>,
            GetMd5Hash(emailAddress),
            options.Size,
            <span class="str">"&amp;d="</span> + options.DefaultImageType,
            <span class="str">"&amp;r="</span> + options.RatingLevel
            )
        );

    <span class="kwrd">return</span> <span class="kwrd">new</span> HtmlString(imgTag.ToString(TagRenderMode.SelfClosing));
}</pre>

Unfortunately there isn’t quite the exact Bootstrap class we need to make our image place and size well in the navbar, so we’ll need to open up our bootstrap.custom.css file and add the following structural class:
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p><pre class="csharpcode">.navbar-image {<br>  float: left;<br>  padding: 10px 5px;<br>}</pre></p>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>Finally, we’ll pop over to our _LoginPartial.cshtml (in Views\Shared) and modify the block of code displayed for logged in users.&nbsp; Because I’m reusing the user’s name a couple of times (which is also their email address) I’m storing it in a variable first, and using that throughout the block. I also add a DIV as a container for our image, using the class that we just created. Last, I make a call to our GravatarImage helper, passing in the username (email!), an appropriate size for the toolbar (30px), and the Bootstrap class that gives us the shape we’re looking for (img-circle).</p>
<p><pre class="csharpcode">var username = User.Identity.GetUserName();<br>using (Html.BeginForm(“LogOff”, “Account”, FormMethod.Post, new { id = “logoutForm”, @class = “navbar-right” }))<br>{</pre></p>
<p>@Html.AntiForgeryToken()</p>
<p><span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">class</span><span class="kwrd">=”navbar-image”</span><span class="kwrd">&gt;</span><br>    @Html.GravatarImage(username, new GravatarOptions { Size = 30, CssClass = “img-circle” })<br><span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span></p>
<p><span class="kwrd">&lt;</span><span class="html">ul</span> <span class="attr">class</span><span class="kwrd">=”nav navbar-nav navbar-right”</span><span class="kwrd">&gt;</span><br>    <span class="kwrd">&lt;</span><span class="html">li</span><span class="kwrd">&gt;</span><br>        @Html.ActionLink(“Hello “ + username + “!”, “Manage”, “Account”, routeValues: null, htmlAttributes: new { title = “Manage” })<br>    <span class="kwrd">&lt;/</span><span class="html">li</span><span class="kwrd">&gt;</span><br>    <span class="kwrd">&lt;</span><span class="html">li</span><span class="kwrd">&gt;&lt;</span><span class="html">a</span> <span class="attr">href</span><span class="kwrd">=”javascript:document.getElementById(‘logoutForm’).submit()”</span><span class="kwrd">&gt;</span>Log off<span class="kwrd">&lt;/</span><span class="html">a</span><span class="kwrd">&gt;&lt;/</span><span class="html">li</span><span class="kwrd">&gt;</span><br><span class="kwrd">&lt;/</span><span class="html">ul</span><span class="kwrd">&gt;</span><br>}</p>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>And now we’re rockin’ head shots in our navbar!</p>
<p><img src="https://jcblogimages.blob.core.windows.net/img/2014/06/image39.png" alt="image" title="image"></p>
<h2 id="Next_Steps"><a href="#Next_Steps" class="headerlink" title="Next Steps"></a>Next Steps</h2><p>Perhaps you’ve modified your user profiles so that the username doesn’t have to be an email address. You could easily modify this example to read from a different property and generate the same type of effect.</p>
<p>What is sparkle without shine? Let’s give our users the ability to choose their own look-and-feel.&nbsp; I mean, it worked for GeoCities, right?</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jameschambers.com/2014/06/day-22-sprucing-up-identity-for-logged-in-users/" data-id="civiom2i000jmbwyyznqje2c6" class="article-share-link">Share</a>
      
        <a href="http://jameschambers.com/2014/06/day-22-sprucing-up-identity-for-logged-in-users/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/30DaysMvcBootstrap/">30DaysMvcBootstrap</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Asp-Net-MVC/">Asp.Net MVC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC/">MVC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC5/">MVC5</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-day-21-cleaning-up-filtering-the-layout-the-menu" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/day-21-cleaning-up-filtering-the-layout-the-menu/">Day 21: Cleaning Up Filtering, the Layout &amp; the Menu</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2014/06/day-21-cleaning-up-filtering-the-layout-the-menu/">
      <time datetime="2014-06-26T06:18:00.000Z" itemprop="datePublished">2014-06-26</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Code-Dive/">Code Dive</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>This is an installment in a 30 day series on Bootstrap and the MVC Framework. To see more, check out <a href="http://jameschambers.com/2014/06/day-0-boothstrapping-mvc-for-the-next-30-days/">Day 0 for an index</a>.</p>
<p>In software development we often talk about concepts like the Single Responsibility Principle. Web pages are often doing <em>lots</em> of things, so it’s hard to say that it should always apply when we’re building our views. But, in the spirit of Martin Fowler’s take on it, I would argue that our _Layout.cshtml is starting to get a lot of reasons as to why it might change, and for that reason, we’re going to split out the menu.</p>
<h2 id="Extracting_the_Menu"><a href="#Extracting_the_Menu" class="headerlink" title="Extracting the Menu"></a>Extracting the Menu</h2><p>In your Views\Shared folder add another partial called _MenuPartial.cshtml and paste in the following code.</p>
<pre class="csharpcode">@using SimpleSite.Models
<span class="kwrd">&lt;</span><span class="html">ul</span> <span class="attr">class</span><span class="kwrd">="nav navbar-nav"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">li</span><span class="kwrd">&gt;</span>@Html.ActionLink("Home", "Index", "Home")<span class="kwrd">&lt;/</span><span class="html">li</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">li</span><span class="kwrd">&gt;</span>@Html.ActionLink("About", "About", "Home")<span class="kwrd">&lt;/</span><span class="html">li</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">li</span><span class="kwrd">&gt;</span>@Html.ActionLink("Contact", "Contact", "Home")<span class="kwrd">&lt;/</span><span class="html">li</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">li</span><span class="kwrd">&gt;</span>@Html.ActionLink("My Peeps", "Index", "Simple")<span class="kwrd">&lt;/</span><span class="html">li</span><span class="kwrd">&gt;</span>

    @if (ViewBag.Notifications != null)
    {
        foreach (NotificationViewModel notification in ViewBag.Notifications)
        {
            <span class="kwrd">&lt;</span><span class="html">li</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">a</span> <span class="attr">href</span><span class="kwrd">="#"</span><span class="kwrd">&gt;</span>
                    @notification.NotificationType
                    <span class="kwrd">&lt;</span><span class="html">span</span> <span class="attr">class</span><span class="kwrd">="badge badge-@notification.BadgeClass"</span><span class="kwrd">&gt;</span>
                        @notification.Count
                    <span class="kwrd">&lt;/</span><span class="html">span</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;/</span><span class="html">a</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">li</span><span class="kwrd">&gt;</span>
        }
    }
<span class="kwrd">&lt;/</span><span class="html">ul</span><span class="kwrd">&gt;</span></pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

If you flip back to our _Layout view, you’ll see that this is very close to what we had there. I’ve made two important changes:

1.  I’ve added a link to our SimpleController in the menu.
2.  I’m checking to make sure there is data in the ViewBag before accessing the dynamic property. This will prevent errors should there be no notifications for the users.

If you do #1 without #2 above, you will most definitely get errors because the only place that has notifications injected is in the Index action on the Home controller.

With those bits in place, be sure to pop back into your _Layout, and update the navbar where we had previously added the code for notifications. It should now only include a call to render our _MenuPartial and the _LoginPartial.
<pre class="csharpcode"><span class="kwrd">&lt;</span><span class="html">div</span> <span class="attr">class</span><span class="kwrd">="navbar-collapse collapse"</span><span class="kwrd">&gt;</span>
    @Html.Partial("_MenuPartial")
    @Html.Partial("_LoginPartial")
<span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span></pre>

<p>If you run the site at this point you won’t get any errors, but you’ll only see the notifications on the home page. Let’s address that.</p>
<h2 id="Globally_Registering_an_Action_Filter"><a href="#Globally_Registering_an_Action_Filter" class="headerlink" title="Globally Registering an Action Filter"></a>Globally Registering an Action Filter</h2><p>We’re now going to set it up so that our NotificationFilter is executed on every request. I just ask that you remember that this is a demo, and that there are <a href="http://jameschambers.com/2014/06/day-20-an-actionfilter-to-inject-notifications/">a few caveats you should be aware of</a>.</p>
<p>During application startup (checkout your global.asax in the root of the site) you’ll notice a call to FilterConfig.RegisterGlobalFilters. There is no magic here. There’s a static method on a class located in your App_Start folder that helps to keep that global.asax nice and tidy. A GlobalFilterCollection is passed in and we can then add to it. </p>
<p>In previous versions of the MVC template, this wasn’t around, so most folks ended up either dropping in a ton of lifting into Application_Start or otherwise coming up with a comparable solution to the above. Now, the class that does the FilterConfig does the FilterConfig. Kinda like that whole Single Responsibility Principle again, eh?</p>
<p>Update FilterConfig (which has the global error handling baked in already) to also include the registration of our filter:</p>
<pre class="csharpcode"><span class="kwrd">public</span> <span class="kwrd">static</span> <span class="kwrd">void</span> RegisterGlobalFilters(GlobalFilterCollection filters)
{
    filters.Add(<span class="kwrd">new</span> HandleErrorAttribute());
    filters.Add(<span class="kwrd">new</span> NotificationFilter());
}</pre>

<p><style type="text/css">.csharpcode, .csharpcode pre<br>{<br>    font-size: small;<br>    color: black;<br>    font-family: consolas, “Courier New”, courier, monospace;<br>    background-color: #ffffff;<br>    /<em>white-space: pre;</em>/<br>}<br>.csharpcode pre { margin: 0em; }<br>.csharpcode .rem { color: #008000; }<br>.csharpcode .kwrd { color: #0000ff; }<br>.csharpcode .str { color: #006080; }<br>.csharpcode .op { color: #0000c0; }<br>.csharpcode .preproc { color: #cc6633; }<br>.csharpcode .asp { background-color: #ffff00; }<br>.csharpcode .html { color: #800000; }<br>.csharpcode .attr { color: #ff0000; }<br>.csharpcode .alt<br>{<br>    background-color: #f4f4f4;<br>    width: 100%;<br>    margin: 0em;<br>}<br>.csharpcode .lnum { color: #606060; }<br></style><br>Now, return to the Home Controller and remove the NotificationFilter attribute from the Index action.&nbsp; It won’t really matter if you don’t (the Framework is smart enough to see that it’s already in play) but you might confuse the future version of yourself when you disable the global registration down the road and the filter keeps getting executed.</p>
<p>You’re all set!</p>
<h2 id="Next_Steps"><a href="#Next_Steps" class="headerlink" title="Next Steps"></a>Next Steps</h2><p>One final step that you might want to consider in the clean up is to move your notification model to a separate DLL, but I’ll leave that as an exercise to the reader as it’s more of a “code” thing and less of an “MVC or Bootstrap” thing.</p>
<p>Next up, we’ll tackle user registration and membership.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jameschambers.com/2014/06/day-21-cleaning-up-filtering-the-layout-the-menu/" data-id="civiom2i400jsbwyygh8i41ax" class="article-share-link">Share</a>
      
        <a href="http://jameschambers.com/2014/06/day-21-cleaning-up-filtering-the-layout-the-menu/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/30DaysMvcBootstrap/">30DaysMvcBootstrap</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Asp-Net-MVC/">Asp.Net MVC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC/">MVC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC5/">MVC5</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-day-20-an-actionfilter-to-inject-notifications" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/day-20-an-actionfilter-to-inject-notifications/">Day 20: An ActionFilter to Inject Notifications</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2014/06/day-20-an-actionfilter-to-inject-notifications/">
      <time datetime="2014-06-25T07:08:00.000Z" itemprop="datePublished">2014-06-25</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Code-Dive/">Code Dive</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>This is an installment in a 30 day series on Bootstrap and the MVC Framework. To see more, check out <a href="http://jameschambers.com/2014/06/day-0-boothstrapping-mvc-for-the-next-30-days/">Day 0 for an index</a>.</p>
<p>Yesterday we added some good-looking notification badges to our site using our <a href="http://jameschambers.com/2014/06/day-18-customizing-and-rendering-bootstrap-badges/">customized Bootstrap badges</a>. Now we need to take care of this nonsense where we need to put the same code into _every single method and every single controller _that we write.</p>
<p><a href="https://jcblogimages.blob.core.windows.net/img/2014/06/image5_thumb.png" title="image[5]" target="_blank" rel="external">![image[5]</a>](<a href="https://jcblogimages.blob.core.windows.net/img/2014/06/image51.png" target="_blank" rel="external">https://jcblogimages.blob.core.windows.net/img/2014/06/image51.png</a>)</p>
<p>Yay for the badges, boo for the code. To get around this, we’ll explore one of many different ways we solve this problem of repeating ourselves by writing an action filter.</p>
<h2 id="A_Bit_About_the_MVC_Pipeline"><a href="#A_Bit_About_the_MVC_Pipeline" class="headerlink" title="A Bit About the MVC Pipeline"></a>A Bit About the MVC Pipeline</h2><p>There’s a lot going on behind the scenes in a web request, but thankfully much of it is abstracted away for most development tasks, and nearly all of it is abstracted away for the end user (could you imagine trying to explain to Mom or Dad how to manually resolve the IP address of domain name? Yikes!).</p>
<p>Sometimes you need to dive into the abstraction, and action filters are one area where this is the case. Remember back on <a href="http://jameschambers.com/2014/06/day-1-the-mvc-5-starter-project/">day one</a> of this series I broke down the request a little? And on <a href="http://jameschambers.com/2014/06/day-2-examining-the-solution-structure/">day two</a> I introduced some of the terminology? Well…if you’ve been following along, you can probably infer what an action filter might be up to: before or after executing an action on a controller you get to inspect, prod, poke and otherwise modify the content or even redirect the user as you see fit. From <a href="http://msdn.microsoft.com/en-us/library/gg416513(vs.98" target="_blank" rel="external">MSDN</a>.aspx):</p>
<blockquote>
<p>Action filters. These implement <a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.iactionfilter(v=vs.98" target="_blank" rel="external">IActionFilter</a>.aspx) and wrap the action method execution. The <a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.iactionfilter(v=vs.98" target="_blank" rel="external">IActionFilter</a>.aspx) interface declares two methods: <a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.iactionfilter.onactionexecuting(v=vs.98" target="_blank" rel="external">OnActionExecuting</a>.aspx) and <a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.iactionfilter.onactionexecuted(v=vs.98" target="_blank" rel="external">OnActionExecuted</a>.aspx).<a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.iactionfilter.onactionexecuting(v=vs.98" target="_blank" rel="external">OnActionExecuting</a>.aspx) runs before the action method. <a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.iactionfilter.onactionexecuted(v=vs.98" target="_blank" rel="external">OnActionExecuted</a>.aspx) runs after the action method and can perform additional processing, such as providing extra data to the action method, inspecting the return value, or canceling execution of the action method. </p>
</blockquote>
<p>You can deny access, restrict availability of resources and execute arbitrary code. You even have access to internal parts of MVC, so your filter can be aware of the currently executing controller, action, and target view.</p>
<p>And that’s where we’re going to hook in: just before the view is rendered after the action method has run.</p>
<h2 id="Adding_the_Filter"><a href="#Adding_the_Filter" class="headerlink" title="Adding the Filter"></a>Adding the Filter</h2><p>Add a folder to the root of your site called Filters (this isn’t convention, just a way to help keep you organized) and then add a class called NotificationFilter. Inherit from ActionFilterAttribute, and then override the OnActionExecuted method so that you can add your two cents to the request.&nbsp; Your code will be nearly identical to what you put in the Home controller, except note now that the ViewBag property is actually accessed through the Controller property on your filterContext.</p>
<p><pre class="csharpcode"><span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">void</span> OnActionExecuted(ActionExecutedContext filterContext)<br>{<br>    var context = <span class="kwrd">new</span> SiteDataContext();</pre></p>
<pre><code>var notifications = context.Notifications
    .GroupBy(n =&amp;gt; n.NotificationType)
    .Select(g =&amp;gt; &lt;span class=&quot;kwrd&quot;&gt;new&lt;/span&gt; NotificationViewModel
    {
        Count = g.Count(),
        NotificationType = g.Key.ToString(),
        BadgeClass = NotificationType.Email == g.Key
            ? &lt;span class=&quot;str&quot;&gt;&quot;success&quot;&lt;/span&gt;
            : &lt;span class=&quot;str&quot;&gt;&quot;info&quot;&lt;/span&gt;
    });

filterContext.Controller.ViewBag.Notifications = notifications;
</code></pre><p>}</p>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>ActionFilterAttribute gives you four virtual methods for actions and results on executing and executed. You only have to implement the ones that suit your fancy.&nbsp; Because it’s an attribute class, you can decorate your actions (or even your classes) with it and the MVC Framework will pick it up and execute it when the time is right.</p>
<h2 id="Touch_up_the_Controller"><a href="#Touch_up_the_Controller" class="headerlink" title="Touch up the Controller"></a>Touch up the Controller</h2><p>Now on your HomeController we can clean things up a fair bit. Remove almost all the code from the Index action and decorate it with your new attribute.</p>
<p><pre class="csharpcode">[NotificationFilter]<br><span class="kwrd">public</span> ActionResult Index()<br>{<br>    <span class="kwrd">return</span> View();<br>}</pre></p>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>Much cleaner, eh? You can now run your site and you’ll get the same result as we had before, and the notifications will now appear anywhere you place that attribute. If you put it at the class level, all actions on the controller will have the filter applied.&nbsp; Which means I should probably mention…</p>
<h2 id="u2026Some_Notes_and_Caveats"><a href="#u2026Some_Notes_and_Caveats" class="headerlink" title="…Some Notes and Caveats"></a>…Some Notes and Caveats</h2><p>This is a pretty powerful deal, especially at the class level. Heck, you can even globally register your filter and have it execute on every request. Which is why I have to stress some pretty important bits:</p>
<ul>
<li>If it’s <em>always</em> executing, then it’s <em>always</em> executing. Be mindful of decorating your classes as a rule or registering filters globally, especially if you have requests (AJAX) that maybe don’t need the filter.&nbsp; Alternatively, design your filter in such a way that it knows when it should or shouldn’t run.</li>
<li>Lots-of-stuff-going-on doesn’t scale well. Use filters judiciously so that you’re not bogging your site down with unnecessary operations. Be quick in what you do so that you return quickly and keep your performance up. Use profiling if you’re not sure how fast your code is running.</li>
<li>In this example – and I can get away with it because it’s an example – I’m going to the database on each request. It may suit you well to do this, but consider alternate approaches (such as caches with timeouts and operations that invalidate them) so that you’re not making those hits all the time.</li>
</ul>
<h2 id="Next_Steps"><a href="#Next_Steps" class="headerlink" title="Next Steps"></a>Next Steps</h2><p>We still have a few things to clean up from <a href="http://jameschambers.com/2014/06/day-19-long-running-notifications-using-badges-and-entity-framework-code-first/">Day 19</a>, so we’ll keep working away at some housekeeping tasks tomorrow, working on our layout. </p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jameschambers.com/2014/06/day-20-an-actionfilter-to-inject-notifications/" data-id="civiom2i900jybwyy9yczg3on" class="article-share-link">Share</a>
      
        <a href="http://jameschambers.com/2014/06/day-20-an-actionfilter-to-inject-notifications/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/30DaysMvcBootstrap/">30DaysMvcBootstrap</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Asp-Net-MVC/">Asp.Net MVC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC/">MVC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC5/">MVC5</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-day-19-long-running-notifications-using-badges-and-entity-framework-code-first" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/06/day-19-long-running-notifications-using-badges-and-entity-framework-code-first/">Day 19: Long-Running Notifications Using Badges and Entity Framework Code First</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2014/06/day-19-long-running-notifications-using-badges-and-entity-framework-code-first/">
      <time datetime="2014-06-24T05:58:00.000Z" itemprop="datePublished">2014-06-24</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Code-Dive/">Code Dive</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>This is an installment in a 30 day series on Bootstrap and the MVC Framework. To see more, check out <a href="http://jameschambers.com/2014/06/day-0-boothstrapping-mvc-for-the-next-30-days/">Day 0 for an index</a>.</p>
<p>We previously looked at using TempData to store alerts, which is great when what we are trying to alert the user to is a transient message that lives only for the next request. What about the scenario where we have long running notifications? Unread email? Outstanding actions the user must follow up on?</p>
<p>Today we’re going to bang out a solution here…in the interest of time and simplicity this <em>will not</em> be in line with best practices, but come back tomorrow for a discussion on how to get closer to them.</p>
<h2 id="Rocking_Out_A_Model"><a href="#Rocking_Out_A_Model" class="headerlink" title="Rocking Out A Model"></a>Rocking Out A Model</h2><p>If we want a way to indicate that the user needs to take care of something, we need two pieces: some kind of UI to point it out – which we have with badges – and some place to store the data – which we’ll get with EF.&nbsp; Right-click on your Models directory and add a new class, called Notification, and add the following code to it:</p>
<pre class="csharpcode">    <span class="kwrd">public</span> <span class="kwrd">enum</span> NotificationType
    {
        Registration,
        Email
    }

    <span class="kwrd">public</span> <span class="kwrd">class</span> Notification
    {
        <span class="kwrd">public</span> <span class="kwrd">int</span> NotificationId { get; set; }
        <span class="kwrd">public</span> <span class="kwrd">string</span> Title { get; set; }
        <span class="kwrd">public</span> NotificationType NotificationType { get; set; }
        <span class="kwrd">public</span> <span class="kwrd">string</span> Controller { get; set; }
        <span class="kwrd">public</span> <span class="kwrd">string</span> Action { get; set; }
    }</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

These are _just_ classes, but when we lean on Entity Framework, we get a database out of it as well. In the “code first” approach, we first write ourselves a class that represents the data, as we’ve done above. Next, we have to let EF know that we expect a storage mechanism for that data, namely, we create a data context and a DB set (representing a table) inside of another class. Add SiteDataContext as a class in your Models folder and add the following code to it:
<pre class="csharpcode">    <span class="kwrd">public</span> <span class="kwrd">class</span> SiteDataContext : DbContext
    {
        <span class="kwrd">public</span> SiteDataContext() : <span class="kwrd">base</span>(<span class="str">"DefaultConnection"</span>) { }

        <span class="kwrd">public</span> DbSet&lt;Notification&gt; Notifications { get; set; }
    }</pre>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

There’s not much to it: DbSet represents a table and DbContext identifies this as a class that represents a connection to the database. If the DB doesn’t exist, EF creates it for us. We call the base class constructor with a string, which identifies the connection string to use in the web.config file, if present, or the name of the DB that will be created if it doesn’t.

At this point, **build your project **using Shift+Ctrl+B or by pressing F6\. We need the app compiled to take advantage of tooling in Entity Framework.

Now, go to the Package Manager Console (View –&gt; Other Windows –&gt; Package Manager Console) and type the following command:
<pre class="csharpcode">Enable-Migrations -ContextTypeName SimpleSite.Models.SiteDataContext</pre>

<p>You’ll need to make sure that the namespace and class name match what is specified above. This command generates a configuration file that has an empty Seed method (rather, it has some comments in it, but you can delete them).&nbsp; This file can be used by Entity Framework as a way to do advanced configuration, set your own conventions for table naming, or, in our case, seeding the database with some test data.&nbsp; Paste in the following code in the Seed method:</p>
<p><pre class="csharpcode"><span class="kwrd">protected</span> <span class="kwrd">override</span> <span class="kwrd">void</span> Seed(SimpleSite.Models.SiteDataContext context)<br>{<br>    context.Notifications.AddOrUpdate(notification =&gt; notification.Title,<br>        <span class="kwrd">new</span> Notification<br>        {<br>            Title = <span class="str">“John Smith was added to the system.”</span>,<br>            NotificationType = NotificationType.Registration<br>        },<br>        <span class="kwrd">new</span> Notification<br>        {<br>            Title = <span class="str">“Susan Peters was added to the system.”</span>,<br>            NotificationType = NotificationType.Registration<br>        },<br>        <span class="kwrd">new</span> Notification<br>        {<br>            Title = <span class="str">“Just an FYI on Thursday’s meeting”</span>,<br>            NotificationType = NotificationType.Email<br>        });<br>}</pre></p>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>AddOrUpdate is like an “upsert” method you can use to inject or update data in your DB.&nbsp; It accepts a lambda expression that specifies how unique rows are identified, and a parameter array which is a list of objects you want to inject into the specified table. </p>
<h2 id="Updating_our_Database"><a href="#Updating_our_Database" class="headerlink" title="Updating our Database"></a>Updating our Database</h2><p>With support for the migrations in place, we want to create an initial version of the DB and apply it in our development environment. From the Package Manager Console, type these lines of code:</p>
<p><pre class="csharpcode">Add-Migration db-create</pre></p>
<p>Update-Database</p>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>Have a look through the migration class that is generated. Pretty cool, eh? Although this is just a first stab at it, it really shows how you can customize the build up – or tear down – of you tables. It’s worth a whole book of content, though, so I’m not diving in for now! The call to Update-Database executes the Up() method on all outstanding migrations. Everything is tracked for you by EF in the database. </p>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<h2 id="Okay_2C_Here_u2019s_One_Best_Practice"><a href="#Okay_2C_Here_u2019s_One_Best_Practice" class="headerlink" title="Okay, Here’s One Best Practice"></a>Okay, Here’s One Best Practice</h2><p>One thing that I really like about MVC and EF is how easy it is to get data into your view using the entities of your database. One thing that I really hate about MVC and EF is how easy it is to get data into your view using the entities of your database. For reals. It’s great for demos and terrible for production.</p>
<p>Instead, use a view model…a way to decouple your view from your database completely. Get in this habit as early as you can, and then come back and thank me 6 months into the maintenance portion of your contract. </p>
<p>Add another class called NotificationViewModel and write in the following code:</p>
<p><pre class="csharpcode"><span class="kwrd">public</span> <span class="kwrd">class</span> NotificationViewModel<br>{<br>    <span class="kwrd">public</span> <span class="kwrd">int</span> Count { get; set; }<br>    <span class="kwrd">public</span> <span class="kwrd">string</span> NotificationType { get; set; }<br>    <span class="kwrd">public</span> <span class="kwrd">string</span> BadgeClass { get; set; }<br>}</pre></p>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>Rather than relying on the data in the database we’re going to use a projection of the data instead. This can help to shield our UI from changes in the model and eliminate the risk of excess DB access or over-exposing sensitive data. It also allows for other best practices we’ll cover in the days ahead.</p>
<h2 id="Updating_Our_Controller"><a href="#Updating_Our_Controller" class="headerlink" title="Updating Our Controller"></a>Updating Our Controller</h2><p>Update your Index() action to be the following:</p>
<p><pre class="csharpcode"><span class="kwrd">public</span> ActionResult Index()<br>{<br>    var context = <span class="kwrd">new</span> SiteDataContext();</pre></p>
<pre><code>var notifications = context.Notifications
    .GroupBy(n =&amp;gt; n.NotificationType)
    .Select(g =&amp;gt; &lt;span class=&quot;kwrd&quot;&gt;new&lt;/span&gt; NotificationViewModel
    {
        Count = g.Count(),
        NotificationType = g.Key.ToString(),
        BadgeClass = NotificationType.Email == g.Key
            ? &lt;span class=&quot;str&quot;&gt;&quot;success&quot;&lt;/span&gt;
            : &lt;span class=&quot;str&quot;&gt;&quot;info&quot;&lt;/span&gt;
    });

ViewBag.Notifications = notifications;

&lt;span class=&quot;kwrd&quot;&gt;return&lt;/span&gt; View();
</code></pre><p>}</p>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>We’re getting the list of notifications out of the DB, grouping them by type, specifying the style class to use and counting them op.&nbsp; We then set that information in the ViewBag, which is accessible from our views. Note that this approach <em>only</em> works for now in our Index method, and <em>only</em> on the HomeController. Don’t worry, we’ll take care of that tomorrow. <img src="https://jcblogimages.blob.core.windows.net/img/2014/06/wlEmoticon-smile2.png" alt="Smile"></p>
<h2 id="Lighting_up_Notifications_in_the_View"><a href="#Lighting_up_Notifications_in_the_View" class="headerlink" title="Lighting up Notifications in the View"></a>Lighting up Notifications in the View</h2><p>Find the UL element with the class “nav navbar-nav” that contains the LI elements that compose the menu (these are around line 26 for me). At the end of the LI elements, we’re going to inject a few more, so we iterate over the list of notifications that we popped into the ViewBag like so:</p>
<p><pre class="csharpcode">@<span class="kwrd">foreach</span> (NotificationViewModel notification <span class="kwrd">in</span> ViewBag.Notifications)<br>{<br>    &lt;li&gt;&lt;a href=<span class="str">“#”</span>&gt;@notification.NotificationType &lt;span <span class="kwrd">class</span>=<span class="str">“badge badge-@notification.BadgeClass”</span>&gt;@notification.Count&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;<br>}</pre></p>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>We’ve got some more work to do to fully get these working, but you will likely see the direction this is moving in by now, and users will see that something needs to be done about all those…notifications.</p>
<p><img src="https://jcblogimages.blob.core.windows.net/img/2014/06/image37.png" alt="image" title="image"></p>
<h2 id="Next_Steps"><a href="#Next_Steps" class="headerlink" title="Next Steps"></a>Next Steps</h2><p>Well, as I said we’ve got some clean up to do to get a little closer to best practices. Our models are in our web site project and unable to be reused. We have to put code in each and every single action on every controller where we would want to see notifications. Our layout is getting polluted with additional code. There’s no way to resolve notifications. We’re in bad shape!</p>
<p>Check back tomorrow so that we can resolve some of the low hanging fruit and discuss what remains to get some of this train on the rails.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jameschambers.com/2014/06/day-19-long-running-notifications-using-badges-and-entity-framework-code-first/" data-id="civiom2ip00kibwyyhhw96lgm" class="article-share-link">Share</a>
      
        <a href="http://jameschambers.com/2014/06/day-19-long-running-notifications-using-badges-and-entity-framework-code-first/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/30DaysMvcBootstrap/">30DaysMvcBootstrap</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Asp-Net-MVC/">Asp.Net MVC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC/">MVC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC5/">MVC5</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/10/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/31/">31</a><a class="extend next" rel="next" href="/page/12/">Next &raquo;</a>
      </nav>
    </section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">recent</h3>
    <div class="widget">
      <ul id="recent-post" class="no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-title"><a href="/2016/11/Resizing-Images-Using-Azure-Functions/" class="title">How to Resize Images Uploaded to Blob Storage with Azure Functions</a></p>
              <p class="item-date"><time datetime="2016-11-15T13:04:26.000Z" itemprop="datePublished">2016-11-15</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-title"><a href="/2016/11/How-to-organize-types-in-your-scripts/" class="title">How to organize types in your Azure Function scripts</a></p>
              <p class="item-date"><time datetime="2016-11-14T13:00:00.000Z" itemprop="datePublished">2016-11-14</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-title"><a href="/2016/11/Five-Days-of-Azure-Functions/" class="title">Five Days of Azure Functions</a></p>
              <p class="item-date"><time datetime="2016-11-11T21:03:50.000Z" itemprop="datePublished">2016-11-11</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-title"><a href="/2016/09/Bending-ASP-NET-MVC-Core-To-Your-Will/" class="title">Bending ASP.NET Core MVC To Your Will</a></p>
              <p class="item-date"><time datetime="2016-09-09T17:46:34.000Z" itemprop="datePublished">2016-09-09</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-title"><a href="/2016/04/github-authentication-asp-net-core/" class="title">GitHub Authentication with ASP.NET Core</a></p>
              <p class="item-date"><time datetime="2016-04-26T12:12:54.000Z" itemprop="datePublished">2016-04-26</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Buy me a coffee?</h3>
    <div class="widget">
        <a href="https://www.paypal.me/jameschambers/3.5usd" target="_blank"><img src="/content/coffee.png"></a>
    </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">tag cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/30DaysMvcBootstrap/" style="font-size: 17.86px;">30DaysMvcBootstrap</a> <a href="/tags/8DaysOfTableStorage/" style="font-size: 11.43px;">8DaysOfTableStorage</a> <a href="/tags/ASP-NET/" style="font-size: 15px;">ASP.NET</a> <a href="/tags/ASP-NET-5/" style="font-size: 10.71px;">ASP.NET 5</a> <a href="/tags/ASP-NET-Core/" style="font-size: 12.86px;">ASP.NET Core</a> <a href="/tags/ASP-NET-Core-MVC/" style="font-size: 10px;">ASP.NET Core MVC</a> <a href="/tags/ActionFilters/" style="font-size: 10px;">ActionFilters</a> <a href="/tags/AllReady/" style="font-size: 10px;">AllReady</a> <a href="/tags/Android/" style="font-size: 10.71px;">Android</a> <a href="/tags/AngelaSmith/" style="font-size: 10px;">AngelaSmith</a> <a href="/tags/Asp-Net-MVC/" style="font-size: 20px;">Asp.Net MVC</a> <a href="/tags/Authentication/" style="font-size: 10.71px;">Authentication</a> <a href="/tags/Azure/" style="font-size: 17.14px;">Azure</a> <a href="/tags/Azure-Functions/" style="font-size: 11.43px;">Azure Functions</a> <a href="/tags/Azure-Web-Apps/" style="font-size: 10px;">Azure Web Apps</a> <a href="/tags/Azure-Websites/" style="font-size: 13.57px;">Azure Websites</a> <a href="/tags/BUILD/" style="font-size: 10px;">BUILD</a> <a href="/tags/BitBucket/" style="font-size: 10px;">BitBucket</a> <a href="/tags/Bootstrap/" style="font-size: 15.71px;">Bootstrap</a> <a href="/tags/CTT-NUG/" style="font-size: 10px;">CTT .NUG</a> <a href="/tags/Calgary/" style="font-size: 10px;">Calgary</a> <a href="/tags/Cisco-VPN/" style="font-size: 10px;">Cisco VPN</a> <a href="/tags/ClearMeasure/" style="font-size: 10.71px;">ClearMeasure</a> <a href="/tags/CodeProject/" style="font-size: 11.43px;">CodeProject</a> <a href="/tags/Conferences/" style="font-size: 10.71px;">Conferences</a> <a href="/tags/CouchDb/" style="font-size: 10px;">CouchDb</a> <a href="/tags/DNX/" style="font-size: 10px;">DNX</a> <a href="/tags/Dojo/" style="font-size: 10px;">Dojo</a> <a href="/tags/Email/" style="font-size: 10px;">Email</a> <a href="/tags/Entity-Framework/" style="font-size: 13.57px;">Entity Framework</a> <a href="/tags/Extension-Methods/" style="font-size: 10px;">Extension Methods</a> <a href="/tags/FontAwesome/" style="font-size: 10.71px;">FontAwesome</a> <a href="/tags/GenFu/" style="font-size: 10px;">GenFu</a> <a href="/tags/GetManifestResourceStream/" style="font-size: 10px;">GetManifestResourceStream</a> <a href="/tags/Git/" style="font-size: 11.43px;">Git</a> <a href="/tags/HTML5/" style="font-size: 10px;">HTML5</a> <a href="/tags/HackAThon/" style="font-size: 10px;">HackAThon</a> <a href="/tags/HtmlHelper/" style="font-size: 10px;">HtmlHelper</a> <a href="/tags/IIS/" style="font-size: 10px;">IIS</a> <a href="/tags/JSON/" style="font-size: 10.71px;">JSON</a> <a href="/tags/Keynote/" style="font-size: 10px;">Keynote</a> <a href="/tags/Life-Hack/" style="font-size: 10px;">Life Hack</a> <a href="/tags/Life-Hacking/" style="font-size: 10.71px;">Life Hacking</a> <a href="/tags/Life-Hacks/" style="font-size: 12.86px;">Life Hacks</a> <a href="/tags/Linq/" style="font-size: 10px;">Linq</a> <a href="/tags/MIX11/" style="font-size: 10px;">MIX11</a> <a href="/tags/MVA/" style="font-size: 10.71px;">MVA</a> <a href="/tags/MVC/" style="font-size: 19.29px;">MVC</a> <a href="/tags/MVC5/" style="font-size: 18.57px;">MVC5</a> <a href="/tags/MVC6/" style="font-size: 13.57px;">MVC6</a> <a href="/tags/MVP/" style="font-size: 10px;">MVP</a> <a href="/tags/Make-Code-Not-War/" style="font-size: 10px;">Make Code Not War</a> <a href="/tags/MeasureUp/" style="font-size: 10px;">MeasureUp</a> <a href="/tags/Metro/" style="font-size: 10px;">Metro</a> <a href="/tags/Microsoft/" style="font-size: 10px;">Microsoft</a> <a href="/tags/Microsoft-Band/" style="font-size: 12.14px;">Microsoft Band</a> <a href="/tags/Mobile/" style="font-size: 10px;">Mobile</a> <a href="/tags/Mobile-Services/" style="font-size: 10px;">Mobile Services</a> <a href="/tags/Motivate/" style="font-size: 10px;">Motivate</a> <a href="/tags/MvcScaffolding/" style="font-size: 11.43px;">MvcScaffolding</a> <a href="/tags/Not-Coding-At-All/" style="font-size: 10px;">Not Coding At All</a> <a href="/tags/NuGet/" style="font-size: 15px;">NuGet</a> <a href="/tags/OData/" style="font-size: 10px;">OData</a> <a href="/tags/PayPal/" style="font-size: 10px;">PayPal</a> <a href="/tags/PostSharp/" style="font-size: 10px;">PostSharp</a> <a href="/tags/Practice/" style="font-size: 10.71px;">Practice</a> <a href="/tags/Practice-of-Awesome/" style="font-size: 10px;">Practice of Awesome</a> <a href="/tags/PrairieDevCon/" style="font-size: 16.43px;">PrairieDevCon</a> <a href="/tags/Queues/" style="font-size: 10px;">Queues</a> <a href="/tags/REST/" style="font-size: 10px;">REST</a> <a href="/tags/Radio/" style="font-size: 10px;">Radio</a> <a href="/tags/Razor/" style="font-size: 10.71px;">Razor</a> <a href="/tags/Real-Life/" style="font-size: 10px;">Real Life</a> <a href="/tags/Regina/" style="font-size: 10.71px;">Regina</a> <a href="/tags/Remote-Work/" style="font-size: 11.43px;">Remote Work</a> <a href="/tags/Resolve/" style="font-size: 10px;">Resolve</a> <a href="/tags/Rock-Paper-Scissors/" style="font-size: 10px;">Rock Paper Scissors</a> <a href="/tags/Routing/" style="font-size: 10px;">Routing</a> <a href="/tags/Ruby-on-Rails/" style="font-size: 10px;">Ruby on Rails</a> <a href="/tags/SDEC/" style="font-size: 10px;">SDEC</a> <a href="/tags/SOAP/" style="font-size: 10px;">SOAP</a> <a href="/tags/SQL-Server/" style="font-size: 10px;">SQL Server</a> <a href="/tags/ServiceBus/" style="font-size: 10px;">ServiceBus</a> <a href="/tags/SignalR/" style="font-size: 11.43px;">SignalR</a> <a href="/tags/Speaking/" style="font-size: 11.43px;">Speaking</a> <a href="/tags/TFS/" style="font-size: 10px;">TFS</a> <a href="/tags/Table-Storage/" style="font-size: 10.71px;">Table Storage</a> <a href="/tags/TypeScript/" style="font-size: 10px;">TypeScript</a> <a href="/tags/Unit-Testing/" style="font-size: 10px;">Unit Testing</a> <a href="/tags/Visual-Studio/" style="font-size: 10.71px;">Visual Studio</a> <a href="/tags/Visual-Studio-11/" style="font-size: 11.43px;">Visual Studio 11</a> <a href="/tags/Visual-Studio-2010/" style="font-size: 16.43px;">Visual Studio 2010</a> <a href="/tags/Visual-Studio-2012/" style="font-size: 12.86px;">Visual Studio 2012</a> <a href="/tags/Visual-Studio-2013/" style="font-size: 10.71px;">Visual Studio 2013</a> <a href="/tags/Visual-Studio-2015/" style="font-size: 15.71px;">Visual Studio 2015</a> <a href="/tags/WCF/" style="font-size: 10.71px;">WCF</a> <a href="/tags/Web-API/" style="font-size: 11.43px;">Web API</a> <a href="/tags/Web-Development/" style="font-size: 10px;">Web Development</a> <a href="/tags/Web-Services/" style="font-size: 10.71px;">Web Services</a> <a href="/tags/Windows-8/" style="font-size: 11.43px;">Windows 8</a> <a href="/tags/Windows-Azure/" style="font-size: 10px;">Windows Azure</a> <a href="/tags/Windows-Phone/" style="font-size: 14.29px;">Windows Phone</a> <a href="/tags/Windws-Live-Writer/" style="font-size: 10px;">Windws Live Writer</a> <a href="/tags/Winnipeg/" style="font-size: 10.71px;">Winnipeg</a> <a href="/tags/c/" style="font-size: 13.57px;">c#</a> <a href="/tags/compiling/" style="font-size: 10px;">compiling</a> <a href="/tags/jQuery/" style="font-size: 12.14px;">jQuery</a> <a href="/tags/jQuery-UI/" style="font-size: 10.71px;">jQuery UI</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/open-source/" style="font-size: 10.71px;">open source</a> <a href="/tags/reflection/" style="font-size: 10px;">reflection</a> <a href="/tags/seed-data/" style="font-size: 10px;">seed data</a> <a href="/tags/testing/" style="font-size: 10px;">testing</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/">2016</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/">2015</a><span class="archive-list-count">36</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/">2014</a><span class="archive-list-count">42</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/">2013</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/">2012</a><span class="archive-list-count">41</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/">2011</a><span class="archive-list-count">36</span></li></ul>
    </div>
  </div>

  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 1999 - 2016 James Chambers<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    

<script>
  var disqus_shortname = 'jameschambers';
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



 <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>




  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>