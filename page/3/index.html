<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>They Call Me Mister James</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This is the blog of James Chambers, a senior developer on the .NET stack">
<meta property="og:type" content="website">
<meta property="og:title" content="They Call Me Mister James">
<meta property="og:url" content="http://jameschambers.com/page/3/index.html">
<meta property="og:site_name" content="They Call Me Mister James">
<meta property="og:description" content="This is the blog of James Chambers, a senior developer on the .NET stack">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="They Call Me Mister James">
<meta name="twitter:description" content="This is the blog of James Chambers, a senior developer on the .NET stack">
<meta name="twitter:creator" content="@CanadianJames">
<meta name="twitter:site" content="CanadianJames">
  
  
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="content/avatar.png">
  
  
 <link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600' rel='stylesheet' type='text/css'>
 <link href='https://fonts.googleapis.com/css?family=Source+Code+Pro' rel='stylesheet' type='text/css'>


  <link rel="stylesheet" href="/css/style.css" type="text/css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css" type="text/css">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-2868185-6', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  

  
  <script src="//load.sumome.com/" data-sumo-site-id="34f480920bcf5ea13ec1605be65d32e86be89fb7177416fb68c2d2f1939aaa04" async="async"></script>
</head>
<body>
  <div id="container">
    <header id="header">
  <div id="header-main" class="header-inner">
    <div class="outer">
      <a href="/" id="logo"><i class="logo" style="background-image: url(/content/logo_round.png)"></i><span class="site-title">They Call Me Mister James</span></a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/.">Home</a>
        
          <a class="main-nav-link" href="/about/bootstrapping-mvc.html">Boostrapping MVC</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">Testimonials</a>
        
          <a class="main-nav-link" href="/about/genfu.html">GenFu</a>
        
        <a class="main-nav-link main-nav-link-highlight" href="https://hireme.jameschambers.com" target="_blank">Hire Me</a>
      </nav>
      
        <nav id="sub-nav">
          <div class="profile" id="profile-nav">
            <a id="profile-anchor" href="javascript:;"><img class="avatar" src="/content/avatar.png"><i class="fa fa-caret-down"></i></a>
          </div>
        </nav>
      
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit"> </button><input type="hidden" name="sitesearch" value="http://jameschambers.com"></form>
      </div>
    </div>
  </div>
  <div id="main-nav-mobile" class="header-sub header-inner">
    <table class="menu outer">
      <tr>
        
          <td><a class="main-nav-link" href="/.">Home</a></td>
        
          <td><a class="main-nav-link" href="/about/bootstrapping-mvc.html">Boostrapping MVC</a></td>
        
          <td><a class="main-nav-link" href="/archives">Archives</a></td>
        
          <td><a class="main-nav-link" href="/about">Testimonials</a></td>
        
          <td><a class="main-nav-link" href="/about/genfu.html">GenFu</a></td>
        
        <td>
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="hidden" name="sitesearch" value="http://jameschambers.com"></form>
        </td>
      </tr>
    </table>
  </div>
</header>

    <div class="outer">
      
        <aside id="profile">
  <div class="inner profile-inner">
    <div class="base-info profile-block">
      <h2 id="name">James Chambers</h2>
      <h3 id="title">Husband, Father, Mentor, Humanitarian &amp; Software Developer</h3>
      <span id="location"><i class="fa fa-map-marker"></i>Canada</span>
      <a id="follow" href="https://twitter.com/canadianjames">FOLLOW</a>
    </div>

    
    <div class="contact-info profile-block">
      <table class="contact-list">
        <tr>
          
          <td><a href="/CanadianJames" target="_blank" title="twitter"><i class="fa fa-twitter"></i></a></td>
          
          <td><a href="http://github.com/MisterJames" target="_blank" title="github"><i class="fa fa-github"></i></a></td>
          
          <td><a href="/atom.xml" target="_blank" title="rss"><i class="fa fa-rss"></i></a></td>
          
          <td><a href="https://ca.linkedin.com/in/canadianjames" target="_blank" title="linkedin"><i class="fa fa-linkedin"></i></a></td>
          
          <td><a href="https://www.youtube.com/user/CodingMisterJames/" target="_blank" title="youtube"><i class="fa fa-youtube"></i></a></td>
          
        </tr>
      </table>
    </div>
    

    <div class="base-info profile-block">
        <a href="http://aspnetmonsters.com" target="_blank"><img src="/content/monster-james.png"></a>      
    </div>

    <div class="base-info profile-block">
        <a href="https://leanpub.com/bootstrappingmvc" onclick="_gaq.push(['_trackEvent', 'outbound-widget', 'https://leanpub.com/bootstrappingmvc', '\n\n']);">
            <img src="https://s3.amazonaws.com/titlepages.leanpub.com/bootstrappingmvc/medium?1425560219" scale="0">
        </a>
    </div>
        
    
  </div>
</aside>

      
      <section id="main">
      <article id="post-getting-your-build-server-ready-for-vs-2015" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/getting-your-build-server-ready-for-vs-2015/">Getting Your Build Server Ready for VS 2015</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2015/07/getting-your-build-server-ready-for-vs-2015/">
      <time datetime="2015-07-25T03:33:57.000Z" itemprop="datePublished">2015-07-24</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/MVC6-Conversion/">MVC6 Conversion</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>If you’re modernizing your project, one of the things you’ll surely want to do is to make sure that your build server is upgraded to support VS 2015. Regardless of what CI engine you’re using, there will be at least a little bit of effort required to get your project building again.</p>
<p><em>In this series we’re working through the conversion of an MVC 5-based application and migrating it to MVC 6. You can track the entire series of posts from the </em><a href="http://jameschambers.com/2015/07/upgrading-a-real-world-mvc-5-application-to-mvc-6/"><em>intro page</em></a><em>.</em></p>
<p>For the purpose of this exercise, we’re using TeamCity to run our builds based on a VSC checkin. We’ll get TeamCity prepped to run our build and then update our repository so that we show our build status indicator on the readme home page.</p>
<h2 id="The_TL_3BDR_Details"><a href="#The_TL_3BDR_Details" class="headerlink" title="The TL;DR Details"></a>The TL;DR Details</h2><p>Here’s the basics of what was required to get the builds back online:</p>
<ul>
<li>Backup and upgrade TeamCity</li>
<li>Allow the agents to upgrade, or upgrade them manually</li>
<li>Install .NET 4.6 and the <a href="https://www.microsoft.com/en-us/download/details.aspx?id=48159" target="_blank" rel="external">VS 2015 tools</a></li>
<li>Ensure that build targets live on your build agents</li>
<li>Run your build</li>
</ul>
<h2 id="Upgrading_the_Server"><a href="#Upgrading_the_Server" class="headerlink" title="Upgrading the Server"></a>Upgrading the Server</h2><p>I engaged my teammate <a href="http://www.clear-measure.com/our-team/" target="_blank" rel="external">James Allen</a> here to help with some best practices, namely getting the server backed up. You can either back up the TeamCity data from the web interface or one of the other <a href="https://confluence.jetbrains.com/display/TCD9/TeamCity+Data+Backup" target="_blank" rel="external">recommended approaches</a>, or you could snapshot your server for a reset should one be required. During this process, it’s a good idea to spin down your build agents so that you’re not wrecking anyone’s builds.</p>
<p>Next, we needed to move to version 9.1 of TeamCity, so we ran the <a href="https://confluence.jetbrains.com/display/TCD9/Upgrade" target="_blank" rel="external">upgrade process</a> via the web site. This is a painless task and takes only a fraction of the time it took to back up the data. Failing any troubles (we saw none), your build server should be back online in no time, and the build agents were notified (and complied!) to update themselves as well.</p>
<p><a href="https://jcblogimages.blob.core.windows.net/img/2015/07/image13.png" target="_blank" rel="external"><img src="https://jcblogimages.blob.core.windows.net/img/2015/07/image_thumb5.png" alt="image" title="image"></a>Next, I downloaded and installed the .NET 4.6 installer and the VS 2015 tooling, which can be found on the <a href="https://www.visualstudio.com/downloads/download-visual-studio-vs" target="_blank" rel="external">VS 2015 download page</a>. You’ll need to explore through the available downloads on the page, as you can see on this screenshot, to grab the relevant files. </p>
<p>These installs will need to be run on every build agent.</p>
<p>One thing to note was that my original attempt to get the build running failed because of missing build targets at an expected location. I ended up having to copy files from my local machine, where Visual Studio 2015 is installed, from the path: C:\Program Files (x86)\MSBuild\Microsoft\VisualStudio\v14.0 on the build server.</p>
<p>UPDATE: With the availability of the MS Build Tools for Visual Studio 2015 you no longer have to manually zip up and copy the files. You can download the <a href="https://www.microsoft.com/en-us/download/details.aspx?id=48159" target="_blank" rel="external">MS Build Tools 2015 here</a>.</p>
<h2 id="Verifying_the_Install"><a href="#Verifying_the_Install" class="headerlink" title="Verifying the Install"></a>Verifying the Install</h2><p>You’ll know the tools have been installed correctly if you return to the build configuration settings and add a new build step for msbuild (you don’t have to save it). You’ll see that you’ll have the new options in place:</p>
<p><img src="https://jcblogimages.blob.core.windows.net/img/2015/07/image14.png" alt="image" title="image"></p>
<p>The build server should be good to go now! For us, we’re not using an MSBuild build runner, our application is build with a PowerShell script via a batch file. This allows our build to be executed locally with only a small parameter change, and the CI process is entirely encapsulated in code (and under source control).</p>
<p>Provided your project is pointing at the repository, you’ll have a good shot at running the build at this point. For our project, everything worked as expected.</p>
<p><img src="https://jcblogimages.blob.core.windows.net/img/2015/07/image15.png" alt="image" title="image"></p>
<h2 id="Showing_Some_Bling"><a href="#Showing_Some_Bling" class="headerlink" title="Showing Some Bling"></a>Showing Some Bling</h2><p>Now it’s time to beef up our repo, at least a little. What I’m talking about is wearing our CI on our sleeve, letting everyone on the team (or other watchers of the repository) that our builds are healthy or, perhaps, needing some love; let’s display the build status indicator on our readme, like this:</p>
<p><img src="https://jcblogimages.blob.core.windows.net/img/2015/07/image16.png" alt="image" title="image"></p>
<p>First, drill into the build configuration and locate the advanced options under “General Settings”. You need to enable the status widget. </p>
<p><img src="https://jcblogimages.blob.core.windows.net/img/2015/07/image17.png" alt="image" title="image"></p>
<p>Also, from this screen, take note of your Build Configuration ID. This is important because you’ll need to include it in the server request to generate the badge.</p>
<p>Finally, include the following markdown, which is essentially a formatted link with an image inside of it:</p>
<pre class="csharpcode">Current Build Status [![](http://YOUR_SERVER/app/rest/builds/buildType:(id:YOUR_BUILD_CONFIGURATION_ID)/statusIcon)](http://teamcity/viewType.html?buildTypeId=btN&amp;guest=1)</pre>

<p><style type="text/css">.csharpcode, .csharpcode pre<br>{<br>    font-size: small;<br>    color: black;<br>    font-family: consolas, “Courier New”, courier, monospace;<br>    background-color: #ffffff;<br>    /<em>white-space: pre;</em>/<br>}<br>.csharpcode pre { margin: 0em; }<br>.csharpcode .rem { color: #008000; }<br>.csharpcode .kwrd { color: #0000ff; }<br>.csharpcode .str { color: #006080; }<br>.csharpcode .op { color: #0000c0; }<br>.csharpcode .preproc { color: #cc6633; }<br>.csharpcode .asp { background-color: #ffff00; }<br>.csharpcode .html { color: #800000; }<br>.csharpcode .attr { color: #ff0000; }<br>.csharpcode .alt<br>{<br>    background-color: #f4f4f4;<br>    width: 100%;<br>    margin: 0em;<br>}<br>.csharpcode .lnum { color: #606060; }<br></style>Be sure to replace the obvious placeholder tokens with your own information.</p>
<h2 id="Next_Steps"><a href="#Next_Steps" class="headerlink" title="Next Steps"></a>Next Steps</h2><p>With our build server updated and our builds back online, it’s time to start shifting our targets. In the next post, we’re going to update our projects and recover from any errors/challenges we may discover along the way.</p>
<p>Happy coding! <img src="https://jcblogimages.blob.core.windows.net/img/2015/07/wlEmoticon-smile3.png" alt="Smile"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jameschambers.com/2015/07/getting-your-build-server-ready-for-vs-2015/" data-id="cijk5jqpp00f4m4yy9l26fpi7" class="article-share-link">Share</a>
      
        <a href="http://jameschambers.com/2015/07/getting-your-build-server-ready-for-vs-2015/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC5/">MVC5</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC6/">MVC6</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Visual-Studio-2015/">Visual Studio 2015</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-moving-to-vs-2015-from-vs-2013" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/moving-to-vs-2015-from-vs-2013/">Moving to VS 2015 from VS 2013</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2015/07/moving-to-vs-2015-from-vs-2013/">
      <time datetime="2015-07-24T01:45:48.000Z" itemprop="datePublished">2015-07-23</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/MVC6-Conversion/">MVC6 Conversion</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>The folks on the Visual Studio team have been making it increasingly easier to move from version-to-version with less impact on our projects. In this post I’m going to examine the process of moving from Visual Studio 2013 to Visual Studio 2015.</p>
<p><em>In this series we’re working through the conversion of an MVC 5-based application and migrating it to MVC 6. You can track the entire series of posts from the </em><a href="http://jameschambers.com/2015/07/upgrading-a-real-world-mvc-5-application-to-mvc-6/"><em>intro page</em></a><em>.</em></p>
<h2 id="The_Backstory"><a href="#The_Backstory" class="headerlink" title="The Backstory"></a>The Backstory</h2><p>First, a bit about our application. I said this was a real-world application, and it is. You can <a href="https://github.com/ClearMeasureLabs/ClearMeasureBootcamp" target="_blank" rel="external">clone the repo</a> and run it locally if you like.</p>
<p><img src="https://jcblogimages.blob.core.windows.net/img/2015/07/image10.png" alt="image" title="image"></p>
<p>What we have is an expense report application, albeit a little on the light side for features. No worries, though, that is the intent! But the real pieces of an application sporting <a href="http://jeffreypalermo.com/blog/the-onion-architecture-part-1/" target="_blank" rel="external">Onion Architecture</a> are in place, and there’s quite a bit of commonly-used tech in this bad boy that you would likely find in any real-world app:</p>
<ul>
<li><a href="https://jcblogimages.blob.core.windows.net/img/2015/07/image11.png" target="_blank" rel="external"><img src="https://jcblogimages.blob.core.windows.net/img/2015/07/image_thumb4.png" alt="image" title="image"></a>Separate projects for separate concerns</li>
<li>A UI Project that stands with only a single reference (to Core)</li>
<li>An older version of NHibernate</li>
<li>Unit tests</li>
<li>HTTP Handlers</li>
<li>The Bootstrap CSS/JS library</li>
<li>StructureMap for dependency injection</li>
<li>A database migrations library</li>
<li>A custom workflow engine</li>
</ul>
<p>So, this is no File –&gt; New –&gt; Project here, this is the real deal.</p>
<h2 id="First_Steps"><a href="#First_Steps" class="headerlink" title="First Steps"></a>First Steps</h2><p>The first issue we’re going to address is the fact that our solution and project are currently in VS 2013 “mode”.&nbsp; In the past, you’d likely have to walk through some kind of conversion process and this was usually a compelling enough reason for people to back delay an upgrade. Did you ever have issues with incorrect file paths, incompatible project type identifiers, broken project references and builds broken due to missing dependencies? At times, I’ve even had to resort to manually editing the solution and project files to get a project back online.&nbsp; <strong>Thankfully, this is nothing like that</strong>. There is nothing major we need to do in order to get our project open in Visual Studio 2015, just load the solution from disk.</p>
<p>In the case of Bootcamp, our project opens cleanly and builds as we would expect. But you’ll notice right away a change in the repo.</p>
<p><img src="https://jcblogimages.blob.core.windows.net/img/2015/07/image12.png" alt="image" title="image"></p>
<p>Visual Studio 2015 runs IIS Express in a more specific context than previous versions, which is a huge win. The applicationhost.config is basically everything you need to get the web server up locally while you develop, debug and test, and it replaces what we would used to use for IIS Express for machine-wide configuration.</p>
<p>This file also happens to be in the .vs directory, used only for devs running Visual Studio on Windows. It’s also easily regenerated for other developers and we don’t need to check it into source control, lest we be endlessly trumping each others’ local changes. Instead of any project or solution modifications, we’re instead going to modify the .gitignore file, adding the following line:</p>
<pre class="csharpcode">**/src/.vs/</pre>

<p>Great stuff! Easy, and we’re running in the latest version of everyone’s favorite IDE. We haven’t yet made any project structure changes, haven’t targeted any new .NET bits, but now we’re ready to start those pieces.</p>
<p>The pull request for this post can be <a href="https://github.com/ClearMeasureLabs/ClearMeasureBootcamp/pull/10" target="_blank" rel="external">reviewed here</a>.</p>
<p><strong><font style="background-color: rgb(204, 204, 204);">&nbsp; Pro tip&nbsp; </font></strong> To get your solution to open in Visual Studio 2015 by default, instead of Visual Studio 2013, you can simply update the first few lines of your .sln file to include the following:<br> <font face="Lucida Console"># Visual Studio 14</font></p>
<p>VisualStudioVersion = 14.0.23107.0</p>
<h2 id="Next_Steps"><a href="#Next_Steps" class="headerlink" title="Next Steps"></a>Next Steps</h2><p>I’ve been running different incarnations of VS 2015 on my machine alongside Visual Studio 2013 (and for a period, VS 2010 as well) without any gotchas. There are some great new features that are worth checking out (it’s <a href="https://www.visualstudio.com/en-us/news/vs2015-vs.aspx" target="_blank" rel="external">a long list</a>), and your team may be able to leverage them.</p>
<p>While this is a short and single-focused post, I hope you see that opening the project in VS 2015 may yield no negative side effects. Heck, if you’re not sure you want to try it on your metal, you can even jump on a free trial of Azure and attempt to open your project on a VM running 2015.</p>
<p>Happy coding! <img src="https://jcblogimages.blob.core.windows.net/img/2015/07/wlEmoticon-smile2.png" alt="Smile"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jameschambers.com/2015/07/moving-to-vs-2015-from-vs-2013/" data-id="cijk5jqny00c6m4yy958ee028" class="article-share-link">Share</a>
      
        <a href="http://jameschambers.com/2015/07/moving-to-vs-2015-from-vs-2013/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ClearMeasure/">ClearMeasure</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC5/">MVC5</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC6/">MVC6</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-upgrading-a-real-world-mvc-5-application-to-mvc-6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/upgrading-a-real-world-mvc-5-application-to-mvc-6/">Upgrading a Real-World MVC 5 Application to MVC 6</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2015/07/upgrading-a-real-world-mvc-5-application-to-mvc-6/">
      <time datetime="2015-07-24T00:19:13.000Z" itemprop="datePublished">2015-07-23</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/MVC6-Conversion/">MVC6 Conversion</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>These are exciting times for web development on the Microsoft stack, but perhaps a little confusing as well. For many years the cycle of moving from one solution and project system to the next hasn’t been overly complex. Sure, there have been breaking changes, I’ve felt those pains myself, but provided the framework you were using continued to live on, there was a reasonable migration path.</p>
<p>Moving to MVC 6 is going to be a big shift for a lot of development teams, but that doesn’t mean it needs to be scary, complicated or introduce instability into your project.</p>
<p>It does, however, mean that you’re going to need an attitude of learning, that you’ll pick up some new tooling, you’ll have to brush up on your JavaScript and work with some new concepts.</p>
<h2 id="Let_u2019s_Make_it_Happen"><a href="#Let_u2019s_Make_it_Happen" class="headerlink" title="Let’s Make it Happen"></a>Let’s Make it Happen</h2><p>I’m super excited to now be part of the excellent crew at <a href="http://clear-measure.com/" target="_blank" rel="external">Clear Measure</a>, where this type of attitude seems to be fostered, encouraged and embodied by other members of the team and, more importantly, the management.</p>
<p>We’re now undertaking the process of converting from MVC5 =&gt; MVC6 with our <a href="https://github.com/ClearMeasureLabs/ClearMeasureBootcamp" target="_blank" rel="external">Bootcamp workshop project</a> and I have the privilege of blogging my experience with it as I go. <a href="https://jcblogimages.blob.core.windows.net/img/2015/07/image7.png" target="_blank" rel="external"><img src="https://jcblogimages.blob.core.windows.net/img/2015/07/image_thumb2.png" alt="image" title="image"></a>We’re going to keep the project building and operable as we go, such that at an point it can be shipped to production or branched for feature development.&nbsp; We’ll be using GitFlow, feature branches, continuous integration and continuous deployment.&nbsp; Our check-ins will be code that builds cleanly with passing tests.</p>
<p><strong>And,</strong> for those of you who come join in our our MVC Masters Bootcamp sessions, you’ll also get to work on this code base with all the tools, exposure to pair programming, a dedicated product owner and 3 days of intense coding.</p>
<p><a href="http://clear-measure.com/" target="_blank" rel="external"><img src="https://jcblogimages.blob.core.windows.net/img/2015/07/image8.png" alt="image" title="image"></a><strong>Shameless plug</strong>: If you want to level up your team of developers, please reach out to <a href="mailto:gina@clear-measure.com??Subject=MVC%20Masters%20Bootcamp" target="_blank" rel="external">Gina Hollis</a> at Clear Measure to plan an on- or off-site event. We promise to melt your minds.</p>
<h2 id="How_We_u2019re_Getting_There"><a href="#How_We_u2019re_Getting_There" class="headerlink" title="How We’re Getting There"></a>How We’re Getting There</h2><p><a href="https://jcblogimages.blob.core.windows.net/img/2015/07/image9.png" target="_blank" rel="external"><img src="https://jcblogimages.blob.core.windows.net/img/2015/07/image_thumb3.png" alt="image" title="image"></a>Well, to start it off, we’re beginning with our initial commit as the MVC 5 project <a href="https://twitter.com/jeffreypalermo" target="_blank" rel="external">Jeffrey Palermo’s</a> been using in the Masters Bootcamp for some time.</p>
<p>The application is hosted on <a href="https://github.com/ClearMeasureLabs/ClearMeasureBootcamp" target="_blank" rel="external">GitHub</a> and you can <a href="https://github.com/ClearMeasureLabs/ClearMeasureBootcamp/issues/" target="_blank" rel="external">see the issues</a> that we’re identifying and working through. We’re doing the whole thing as open source in hopes that other teams can learn from what we learn in the process.</p>
<p>And, as I knock items off the issue list I’ll be posting about them here, covering the challenges, pitfalls and wins we encounter along the way. You can bookmark this post for updates in the project. Feel free to ask questions on the issues in the repository, or ping me on Twitter (<a href="https://twitter.com/CanadianJames/" target="_blank" rel="external">@CanadianJames</a>).</p>
<p>Stay tuned!</p>
<ul>
<li>Part 1: <a href="http://jameschambers.com/2015/07/moving-to-vs-2015-from-vs-2013/">Moving to VS2015 from VS2013</a></li>
<li>Part 2: <a href="http://jameschambers.com/2015/07/getting-your-build-server-ready-for-vs-2015/">Getting Your Build Server Ready for VS2015</a></li>
<li>Part 3: <a href="http://jameschambers.com/2015/07/upgrading-projects-to-net-4-6/">Retargeting Projects to .NET 4.6</a></li>
<li>Part 4: <a href="http://jameschambers.com/2015/08/converting-net-4-6-projects-to-the-vs-2015-project-system/">Multitargeting Projects with VS2015 Projects</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jameschambers.com/2015/07/upgrading-a-real-world-mvc-5-application-to-mvc-6/" data-id="cijk5jqht003nm4yyqk4po4lk" class="article-share-link">Share</a>
      
        <a href="http://jameschambers.com/2015/07/upgrading-a-real-world-mvc-5-application-to-mvc-6/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ClearMeasure/">ClearMeasure</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC5/">MVC5</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MVC6/">MVC6</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-workaround-nuget-packages-failing-to-download-in-visual-studio-2015-rtm" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/workaround-nuget-packages-failing-to-download-in-visual-studio-2015-rtm/">Workaround: NuGet Packages Failing to Download in Visual Studio 2015 RTM</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2015/07/workaround-nuget-packages-failing-to-download-in-visual-studio-2015-rtm/">
      <time datetime="2015-07-23T19:59:39.000Z" itemprop="datePublished">2015-07-23</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Uncategorized/">Uncategorized</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>I haven’t figured out a common theme yet, but certain packages are failing to restore when you attempt to install them from the NuGet primary feed via the project.json file in Visual Studio 2015. Thanks to <a href="https://twitter.com/BrockLAllen" target="_blank" rel="external">Brock Allen</a> for confirming I wasn’t going insane.</p>
<p>A couple of things I’ve discovered:</p>
<ul>
<li>This seems to be more common for prerelease packages</li>
<li>It seems to work if the package has a previous release version (not in pre)</li>
</ul>
<p>As a workaround, you can add the packages manually via the dialog in Visual Studio, just make sure you hit that pre-release flag:</p>
<p><img src="https://jcblogimages.blob.core.windows.net/img/2015/07/image3.png" alt="image" title="image"></p>
<p>If that doesn’t work for you – sometimes I’m not seeing the package above in my feed – if you have it you can add another NuGet feed to an alternate package source, like I’ve done here with AutoFac’s nightly build feed:</p>
<p><a href="https://jcblogimages.blob.core.windows.net/img/2015/07/image4.png" target="_blank" rel="external"><img src="https://jcblogimages.blob.core.windows.net/img/2015/07/image_thumb1.png" alt="image" title="image"></a></p>
<p>The other thing is that once you get it installed in your system cache, it will resolve it from there, which I imagine makes it harder to triage for anyone trying to figure out what’s going on.</p>
<p>I’m seeing various confirmations of this on Twitter:</p>
<p><img src="https://jcblogimages.blob.core.windows.net/img/2015/07/image5.png" alt="image" title="image"></p>
<p><img src="https://jcblogimages.blob.core.windows.net/img/2015/07/image6.png" alt="image" title="image"></p>
<p>With NuGet 3 being release (and part of VS 2015) I think some package authors are unsure if it’s their problem or what the case may be. Depending on the method you come at it, it’s possible that you can still get the package, but I would say it seems unpredictable right now.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jameschambers.com/2015/07/workaround-nuget-packages-failing-to-download-in-visual-studio-2015-rtm/" data-id="cijk5jqg6000pm4yydub3dng1" class="article-share-link">Share</a>
      
        <a href="http://jameschambers.com/2015/07/workaround-nuget-packages-failing-to-download-in-visual-studio-2015-rtm/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>



    
      <article id="post-response-from-postsharp-net-is-not-a-valid-nuget-v2-service-response" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/response-from-postsharp-net-is-not-a-valid-nuget-v2-service-response/">Response from Postsharp.net is not a Valid Nuget v2 Service Response</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2015/07/response-from-postsharp-net-is-not-a-valid-nuget-v2-service-response/">
      <time datetime="2015-07-22T07:05:22.000Z" itemprop="datePublished">2015-07-22</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Code-Dive/">Code Dive</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p>After installing PostSharp.net on my machine for a project (I did the MSI install) I started getting errors during the package restore that ended up blocking my builds. They looked a lot like this:</p>
<blockquote>
<p>Error: FindPackagesById: EntityFramework.Core Response from <a href="https://www.postsharp.net/nuget/packages/FindPackagesById(" target="_blank" rel="external">https://www.postsharp.net/nuget/packages/FindPackagesById()?id=’EntityFramework.Core’</a>?id=) is not a valid NuGet v2 service response.</p>
</blockquote>
<p><img src="https://jcblogimages.blob.core.windows.net/img/2015/07/image1.png" alt="image" title="image"></p>
<p>Now, an important note here: I’m on a machine that’s seen various updates and changes to VS 2015, and this was a version of PostSharp that wasn’t originally built for the RTM version of Visual Studio. So…this may be entirely circumstantial, but it’s what I ran into.</p>
<p>And it wasn’t just on that one package (others would give the same result) and it wasn’t just on one project. I tried to isolate this, but couldn’t find the source. Why was PostSharp getting in the way of my package restore? Even using DNU from the command line, <strong><em>after</em></strong> I explicitly uninstalled it? I started setting compiler variables to block PostSharp on those projects, but that got frustrating quickly, so I resorted to uninstalling everything I could find of it.</p>
<p>After the uninstall, I still was stumped, same errors all over again. With the help of my friend <a href="https://twitter.com/dbelcham" target="_blank" rel="external">Donald Belcham</a>, I was able to find traces of PostSharp still on my machine, located in the system-wide NuGet package source feed configuration:</p>
<p><img src="https://jcblogimages.blob.core.windows.net/img/2015/07/image2.png" alt="image" title="image"></p>
<p>Unchecking that box above does the trick.</p>
<p>Might be an edge case if you run into this, but if you do, and this helps, consider buying Don a scotch! </p>
<p>Happy coding. <img src="https://jcblogimages.blob.core.windows.net/img/2015/07/wlEmoticon-smile1.png" alt="Smile"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jameschambers.com/2015/07/response-from-postsharp-net-is-not-a-valid-nuget-v2-service-response/" data-id="cijk5jqkl0082m4yynyh1tkyl" class="article-share-link">Share</a>
      
        <a href="http://jameschambers.com/2015/07/response-from-postsharp-net-is-not-a-valid-nuget-v2-service-response/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NuGet/">NuGet</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/PostSharp/">PostSharp</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/compiling/">compiling</a></li></ul>

    </footer>
  </div>
  
</article>



    
      <article id="post-day-3-extracting-a-service-to-interact-with-azure-table-storage" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/day-3-extracting-a-service-to-interact-with-azure-table-storage/">Day 3 – Extracting a Service to Interact with Azure Table Storage</a>
    </h1>
  

        <div class="article-meta">
          
  <div class="article-date">
    <i class="fa fa-calendar"></i>
    <a href="/2015/07/day-3-extracting-a-service-to-interact-with-azure-table-storage/">
      <time datetime="2015-07-18T19:32:58.000Z" itemprop="datePublished">2015-07-18</time>
    </a>
  </div>


          
  <div class="article-category">
  	<i class="fa fa-folder"></i>
    <a class="article-category-link" href="/categories/Uncategorized/">Uncategorized</a>
  </div>

        </div>
      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
                
        <p><em>In <a href="http://jameschambers.com/2015/01/day-0-8-days-of-working-with-azure-table-storage-from-asp-net-mvc-5/">this series</a> we are looking at the basic mechanics of interacting with cloud-based Table Storage from an MVC 5 Application, using the Visual Studio 2013 IDE and Microsoft Azure infrastructure.</em></p>
<p>Our controllers are not supposed to be about anything more than getting models together so that our views have something to present. When we start mixing concerns, our application starts to become very difficult to test, controllers start getting quite complex and the difficulty in maintaining our application can skyrocket. </p>
<p>Let’s avoid that.</p>
<p>If you want to follow along, please <a href="http://www.microsoft.com/click/services/Redirect2.ashx?CR_CC=200575119" target="_blank" rel="external">pop into Azure</a> and make sure you’ve got an account ready to go. The trial is free, so get at it!</p>
<h2 id="Defining_Our_Service"><a href="#Defining_Our_Service" class="headerlink" title="Defining Our Service"></a>Defining Our Service</h2><p>Let’s look at the operations we’re going to need, from what we’ve already implemented, and knowing what we’re planning from <a href="http://jameschambers.com/2015/01/day-0-8-days-of-working-with-azure-table-storage-from-asp-net-mvc-5/">our outline</a>:</p>
<ul>
<li>Insert a record  </li><li>Get a filtered set of records  </li><li>Update a record  </li><li>Deleting a record </li>
</ul>
<p>Cool beans. At first blush it seems like we’ve got a pretty simple set of concerns, but notice that I didn’t include things like “connecting to Azure”, “creating table references” or “reading configuration information”, as those are all separate concerns that our controller doesn’t actually care about.&nbsp; Remember, we’re trying to isolate our concerns. </p>
<p>Hrm…so, manipulating records, adding, deleting, filtering, separating concerns from our business logic…this is starting to sound familiar, right?&nbsp; </p>
<blockquote>
<p>Use a <strong>repository</strong> to separate the logic that retrieves the data and maps it to the entity model from the business logic that acts on the model. The business logic should be agnostic to the type of data that comprises the data source layer. Source: <a href="https://msdn.microsoft.com/en-us/library/ff649690.aspx" target="_blank" rel="external">MSDN</a>. </p>
</blockquote>
<p>So, we’re going to want to build something using the repository pattern. We’ll use that repository here in our application’s controllers, but in a larger project you might go even further to have an application services layer where you map between the domain models and the view models that we have in our views. All in, our interface might look like the following:</p>
<p><pre class="csharpcode"><span class="kwrd">public</span> <span class="kwrd">interface</span> ITableStorageRepository&lt;T&gt; <span class="kwrd">where</span> T : TableEntity<br>{<br>    <span class="kwrd">void</span> Insert(T entity);<br>    <span class="kwrd">void</span> Update(T entity);<br>    <span class="kwrd">void</span> Delete(T entity);<br>    IEnumerable&lt;T&gt; GetByPartition(<span class="kwrd">string</span> partitionKey);<br>}</pre></p>
<style type="text/css">.csharpcode, .csharpcode pre
{
    font-size: small;
    color: black;
    font-family: consolas, "Courier New", courier, monospace;
    background-color: #ffffff;
    /*white-space: pre;*/
}
.csharpcode pre { margin: 0em; }
.csharpcode .rem { color: #008000; }
.csharpcode .kwrd { color: #0000ff; }
.csharpcode .str { color: #006080; }
.csharpcode .op { color: #0000c0; }
.csharpcode .preproc { color: #cc6633; }
.csharpcode .asp { background-color: #ffff00; }
.csharpcode .html { color: #800000; }
.csharpcode .attr { color: #ff0000; }
.csharpcode .alt 
{
    background-color: #f4f4f4;
    width: 100%;
    margin: 0em;
}
.csharpcode .lnum { color: #606060; }
</style>

<p>The public interface simply gives us a way to do our CRUD operations and treat a filtered result set <a href="http://martinfowler.com/eaaCatalog/repository.html" target="_blank" rel="external">as a collection</a> in order to minimize duplicate constructs and operations related to table queries. You can think of the CloudTableClient and TableQueries from the Azure SDK as part of a <a href="http://martinfowler.com/eaaCatalog/dataMapper.html" target="_blank" rel="external">Data Mapper</a> layer that enables us to build this abstraction.</p>
<p>Note: For the purpose of illustration, I’m going to continue to use TableEntity here, which doesn’t completely abstract the Azure Table Storage concern away from my controller. I understand that; in a real-world scenario, I would typically have a view model that is used in the MVC application and an intermediary service would handle mapping as required.</p>
<h2 id="Implementing_the_Service"><a href="#Implementing_the_Service" class="headerlink" title="Implementing the Service"></a>Implementing the Service</h2><p>Leveraging this is going to be awesome, but we need to move some of the heavy-lifting out of our controller first.&nbsp; Let’s start by creating a Repositories folder and adding a class called KittehRepository, which will of course implement ITableStorageRepository&lt;KittehEntity&gt;.</p>
<p><strong>Don’t peak!</strong> As an exercise for the reader, you can use the interface noted above to implement the class. Use the interface above to craft your KittehRepository class. You should be able to find all the bits you need by exploring the objects already in use in the controller.</p>
<p>When you’re ready, here’s my version of the solution below:</p>
<p><pre class="csharpcode"><span class="kwrd">public</span> <span class="kwrd">class</span> KittehRepository : ITableStorageRepository&lt;KittehEntity&gt;<br>{<br>    <span class="kwrd">private</span> <span class="kwrd">readonly</span> CloudTableClient _client;</pre></p>
<pre><code>&lt;span class=&quot;kwrd&quot;&gt;public&lt;/span&gt; KittehRepository()
{
    var storageAccount = CloudStorageAccount.Parse(CloudConfigurationManager.GetSetting(&lt;span class=&quot;str&quot;&gt;&quot;StorageConnectionString&quot;&lt;/span&gt;));
    _client = storageAccount.CreateCloudTableClient();
}

&lt;span class=&quot;kwrd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kwrd&quot;&gt;void&lt;/span&gt; Insert(KittehEntity entity)
{
    var kittehTable = _client.GetTableReference(&lt;span class=&quot;str&quot;&gt;&quot;PicturesOfKittehs&quot;&lt;/span&gt;);
    var insert = TableOperation.Insert(entity);
    kittehTable.Execute(insert);
}

&lt;span class=&quot;kwrd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kwrd&quot;&gt;void&lt;/span&gt; Update(KittehEntity entity)
{
    var kittehTable = _client.GetTableReference(&lt;span class=&quot;str&quot;&gt;&quot;PicturesOfKittehs&quot;&lt;/span&gt;);
    var insert = TableOperation.Replace(entity);
    kittehTable.Execute(insert);
}

&lt;span class=&quot;kwrd&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;kwrd&quot;&gt;void&lt;/span&gt; Delete(KittehEntity entity)
{
    var kittehTable = _client.GetTableReference(&lt;span class=&quot;str&quot;&gt;&quot;PicturesOfKittehs&quot;&lt;/span&gt;);
    var insert = TableOperation.Delete(entity);
    kittehTable.Execute(insert);
}

&lt;span class=&quot;kwrd&quot;&gt;public&lt;/span&gt; IEnumerable&amp;lt;KittehEntity&amp;gt; GetByPartition(&lt;span class=&quot;kwrd&quot;&gt;string&lt;/span&gt; partitionKey)
{
    var kittehTable = _client.GetTableReference(&lt;span class=&quot;str&quot;&gt;&quot;PicturesOfKittehs&quot;&lt;/span&gt;);
    var kittehQuery = &lt;span class=&quot;kwrd&quot;&gt;new&lt;/span&gt; TableQuery&amp;lt;KittehEntity&amp;gt;()
                    .Where(TableQuery.GenerateFilterCondition(&lt;span class=&quot;str&quot;&gt;&quot;PartitionKey&quot;&lt;/span&gt;, QueryComparisons.Equal, partitionKey));
    var kittehs = kittehTable.ExecuteQuery(kittehQuery).ToList();

    &lt;span class=&quot;kwrd&quot;&gt;return&lt;/span&gt; kittehs;
}
</code></pre><p>}<style type="text/css">.csharpcode, .csharpcode pre<br>{<br>    font-size: small;<br>    color: black;<br>    font-family: consolas, “Courier New”, courier, monospace;<br>    background-color: #ffffff;<br>    /<em>white-space: pre;</em>/<br>}<br>.csharpcode pre { margin: 0em; }<br>.csharpcode .rem { color: #008000; }<br>.csharpcode .kwrd { color: #0000ff; }<br>.csharpcode .str { color: #006080; }<br>.csharpcode .op { color: #0000c0; }<br>.csharpcode .preproc { color: #cc6633; }<br>.csharpcode .asp { background-color: #ffff00; }<br>.csharpcode .html { color: #800000; }<br>.csharpcode .attr { color: #ff0000; }<br>.csharpcode .alt<br>{<br>    background-color: #f4f4f4;<br>    width: 100%;<br>    margin: 0em;<br>}<br>.csharpcode .lnum { color: #606060; }<br></style></p>
<p>One thing to note is that I’ve pushed <em>most</em> of the initialization up to the constructor, and I’ve not implemented any kind of seeding code. The table seeding that I illustrated in <a href="http://jameschambers.com/2015/01/day-1-the-basics-of-the-basics-with-azure-table-storage/">Day 1</a> is a concern that should be implemented outside of a repository, likely as part of a process that starts up the application in first-run scenarios, or something that would be run as part of a deployment to a test/QA environment.</p>
<h2 id="Cleaning_up_Our_Controller"><a href="#Cleaning_up_Our_Controller" class="headerlink" title="Cleaning up Our Controller"></a>Cleaning up Our Controller</h2><p>I love this. The controller can now do what we need it to do. Here’s the complete class, with an added constructor that accepts a reference to the repository (we’ll wire that up shortly):</p>
<p><pre class="csharpcode"><span class="kwrd">public</span> <span class="kwrd">class</span> HomeController : Controller<br>{<br>    <span class="kwrd">private</span> <span class="kwrd">readonly</span> ITableStorageRepository&lt;KittehEntity&gt; _kittehRepository;</pre></p>
<pre><code>&lt;span class=&quot;kwrd&quot;&gt;public&lt;/span&gt; HomeController(ITableStorageRepository&amp;lt;KittehEntity&amp;gt; kittehRepository)
{
    _kittehRepository = kittehRepository;
}

&lt;span class=&quot;kwrd&quot;&gt;public&lt;/span&gt; ActionResult Index()
{
    var kittehs = _kittehRepository.GetByPartition(&lt;span class=&quot;str&quot;&gt;&quot;FunnyKittehs&quot;&lt;/span&gt;);
    &lt;span class=&quot;kwrd&quot;&gt;return&lt;/span&gt; View(kittehs);
}

[HttpPost]
&lt;span class=&quot;kwrd&quot;&gt;public&lt;/span&gt; ActionResult Index(KittehEntity entity)
{
    _kittehRepository.Insert(entity);
    &lt;span class=&quot;kwrd&quot;&gt;return&lt;/span&gt; RedirectToAction(&lt;span class=&quot;str&quot;&gt;&quot;Index&quot;&lt;/span&gt;);
}

&lt;span class=&quot;kwrd&quot;&gt;public&lt;/span&gt; ActionResult About()
{
    ViewBag.Message = &lt;span class=&quot;str&quot;&gt;&quot;Your application description page.&quot;&lt;/span&gt;;

    &lt;span class=&quot;kwrd&quot;&gt;return&lt;/span&gt; View();
}

&lt;span class=&quot;kwrd&quot;&gt;public&lt;/span&gt; ActionResult Contact()
{
    ViewBag.Message = &lt;span class=&quot;str&quot;&gt;&quot;Your contact page.&quot;&lt;/span&gt;;

    &lt;span class=&quot;kwrd&quot;&gt;return&lt;/span&gt; View();
}
</code></pre><p>}<br><style type="text/css">.csharpcode, .csharpcode pre<br>{<br>    font-size: small;<br>    color: black;<br>    font-family: consolas, “Courier New”, courier, monospace;<br>    background-color: #ffffff;<br>    /<em>white-space: pre;</em>/<br>}<br>.csharpcode pre { margin: 0em; }<br>.csharpcode .rem { color: #008000; }<br>.csharpcode .kwrd { color: #0000ff; }<br>.csharpcode .str { color: #006080; }<br>.csharpcode .op { color: #0000c0; }<br>.csharpcode .preproc { color: #cc6633; }<br>.csharpcode .asp { background-color: #ffff00; }<br>.csharpcode .html { color: #800000; }<br>.csharpcode .attr { color: #ff0000; }<br>.csharpcode .alt<br>{<br>    background-color: #f4f4f4;<br>    width: 100%;<br>    margin: 0em;<br>}<br>.csharpcode .lnum { color: #606060; }<br></style></p>
<p>Notice how we’ve reduce the amount of code in this class <em>significantly</em>, to the point that anyone should be able to read it – with little or no exposure to Azure Table Storage – and still have a sense of what’s going on. We’ve taken our controller from over 50 lines of code (non-cruft/whitespace) to about 5. </p>
<p>Just to see how much more clear we’ve made things, do a “remove and sort” on your usings. You’ll notice that everything to do with Azure has all but disappeared; our repository has served it’s purpose!</p>
<p>Okay, so the repository is in place, and our controller is dramatically simplified. Now we need to do a bit of wiring to let the MVC Framework know that we’d like an instance of the class when the controller fires up. Here’s how.</p>
<h2 id="Adding_Dependency_Injection"><a href="#Adding_Dependency_Injection" class="headerlink" title="Adding Dependency Injection"></a>Adding Dependency Injection</h2><p>First, open the Package Manager Console (View –&gt; Other Windows –&gt; Package Manager Console) and type the following:</p>
<p><pre class="csharpcode">install-package Ninject.MVC5</pre><style type="text/css">.csharpcode, .csharpcode pre<br>{<br>    font-size: small;<br>    color: black;<br>    font-family: consolas, “Courier New”, courier, monospace;<br>    background-color: #ffffff;<br>    /<em>white-space: pre;</em>/<br>}<br>.csharpcode pre { margin: 0em; }<br>.csharpcode .rem { color: #008000; }<br>.csharpcode .kwrd { color: #0000ff; }<br>.csharpcode .str { color: #006080; }<br>.csharpcode .op { color: #0000c0; }<br>.csharpcode .preproc { color: #cc6633; }<br>.csharpcode .asp { background-color: #ffff00; }<br>.csharpcode .html { color: #800000; }<br>.csharpcode .attr { color: #ff0000; }<br>.csharpcode .alt<br>{<br>    background-color: #f4f4f4;<br>    width: 100%;<br>    margin: 0em;<br>}<br>.csharpcode .lnum { color: #606060; }<br></style></p>
<p>The Ninject packages required for interoperation with the MVC Framework are installed, and you get a new class in _AppStart called NinjectWebCommon. This class contains an assembly-level attribute that allows it to properly wire dependency injection up in your application at startup, you’ll see this at the top of the file.</p>
<p>What happens now is quite interesting: when the MVC Framework tries to create an instance of a controller (i.e., when someone makes a request to your application), it looks for a constructor with no parameters. This no longer exists on our controller because we require the ITableStorageRepository&lt;KittehEntity&gt; parameter.&nbsp; Ninject will now step in for us and say, “Oh, you want something that looks like that? Here’s one I made for you!”</p>
<p>To get that kind of injection love, you need to go into the NinjectWebCommon class and update the RegisterServices method to include this line of code:</p>
<p><pre class="csharpcode">kernel.Bind&lt;ITableStorageRepository&lt;KittehEntity&gt;&gt;().To&lt;KittehRepository&gt;();</pre><style type="text/css">.csharpcode, .csharpcode pre<br>{<br>    font-size: small;<br>    color: black;<br>    font-family: consolas, “Courier New”, courier, monospace;<br>    background-color: #ffffff;<br>    /<em>white-space: pre;</em>/<br>}<br>.csharpcode pre { margin: 0em; }<br>.csharpcode .rem { color: #008000; }<br>.csharpcode .kwrd { color: #0000ff; }<br>.csharpcode .str { color: #006080; }<br>.csharpcode .op { color: #0000c0; }<br>.csharpcode .preproc { color: #cc6633; }<br>.csharpcode .asp { background-color: #ffff00; }<br>.csharpcode .html { color: #800000; }<br>.csharpcode .attr { color: #ff0000; }<br>.csharpcode .alt<br>{<br>    background-color: #f4f4f4;<br>    width: 100%;<br>    margin: 0em;<br>}<br>.csharpcode .lnum { color: #606060; }<br></style></p>
<p>This simply says, “When someone asks for that interface, give them this concrete class.</p>
<p>So at this point, the wiring is done, and you can run your app! It will have the exact same functionality and user experience, but it will be much more technically sound.</p>
<h2 id="Notes_and_Improvements"><a href="#Notes_and_Improvements" class="headerlink" title="Notes and Improvements"></a>Notes and Improvements</h2><p>Just a few things to note:</p>
<ul>
<li>I’ve kept things simple and omitted ViewModels</li>
<li>You’d likely want to have a layer between your controller and repository class in most real-word scenarios</li>
<li>The repository class should have it’s dependencies injected as well, namely, the configuration information it needs to connect to Azure. A proper configuration helper class would do the trick and, once registered with Ninject, could also be accepted as a parameter on the constructor</li>
</ul>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>With the repository in place we can now lighten the load on the controller and more easily implement features with our concerns more clearly separated. In the next couple of posts, we’re going to start allowing the user to manipulate the entities in the table.</p>
<p>Happy coding! <img src="https://jcblogimages.blob.core.windows.net/img/2015/07/wlEmoticon-smile.png" alt="Smile"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jameschambers.com/2015/07/day-3-extracting-a-service-to-interact-with-azure-table-storage/" data-id="cijk5jqrm00hpm4yyvibotyik" class="article-share-link">Share</a>
      
        <a href="http://jameschambers.com/2015/07/day-3-extracting-a-service-to-interact-with-azure-table-storage/#disqus_thread" class="article-comment-link">Comments</a>
      
      
    </footer>
  </div>
  
</article>



    
      <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="space">&hellip;</span><a class="page-number" href="/page/29/">29</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
      </nav>
    </section>
      
        <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">recent</h3>
    <div class="widget">
      <ul id="recent-post" class="no-thumbnail">
        
          <li>
            
            <div class="item-inner">
              <p class="item-title"><a href="/2016/01/2106-01-17-Everything-You-Need-To-Know-About-Band-2-Battery-Life/" class="title">Everything You Need To Know About Microsoft Band 2 Battery Life</a></p>
              <p class="item-date"><time datetime="2016-01-18T02:44:01.000Z" itemprop="datePublished">2016-01-17</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-title"><a href="/2016/01/work-is-not-life/" class="title">Your Work and Your Life are Not Intricately Intertwined</a></p>
              <p class="item-date"><time datetime="2016-01-11T02:24:09.000Z" itemprop="datePublished">2016-01-10</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-title"><a href="/2015/11/the-humanitarian-toolbox-allready-code-a-thon/" class="title">The Humanitarian Toolbox AllReady Code-a-Thon</a></p>
              <p class="item-date"><time datetime="2015-11-18T15:22:00.000Z" itemprop="datePublished">2015-11-18</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-title"><a href="/2015/11/apicontroller-in-asp-net-5-nopesauce/" class="title">ApiController in ASP.NET 5? Nopesauce.</a></p>
              <p class="item-date"><time datetime="2015-11-03T04:39:31.000Z" itemprop="datePublished">2015-11-02</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-inner">
              <p class="item-title"><a href="/2015/09/supporting-options-and-arguments-in-your-dnx-commands/" class="title">Supporting Options and Arguments in Your dnx Commands</a></p>
              <p class="item-date"><time datetime="2015-09-08T18:00:00.000Z" itemprop="datePublished">2015-09-08</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

  
    <div class="widget-wrap">
    <h3 class="widget-title">Buy me a coffee?</h3>
    <div class="widget">
        <a href="https://www.paypal.me/jameschambers/3.5usd" target="_blank"><img src="/content/coffee.png"></a>
    </div>
</div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">tag cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/30DaysMvcBootstrap/" style="font-size: 17.86px;">30DaysMvcBootstrap</a> <a href="/tags/8DaysOfTableStorage/" style="font-size: 11.43px;">8DaysOfTableStorage</a> <a href="/tags/ASP-NET/" style="font-size: 15px;">ASP.NET</a> <a href="/tags/ActionFilters/" style="font-size: 10px;">ActionFilters</a> <a href="/tags/Android/" style="font-size: 10.71px;">Android</a> <a href="/tags/AngelaSmith/" style="font-size: 10px;">AngelaSmith</a> <a href="/tags/Asp-Net-MVC/" style="font-size: 20px;">Asp.Net MVC</a> <a href="/tags/Authentication/" style="font-size: 10px;">Authentication</a> <a href="/tags/Azure/" style="font-size: 17.14px;">Azure</a> <a href="/tags/Azure-Web-Apps/" style="font-size: 10px;">Azure Web Apps</a> <a href="/tags/Azure-Websites/" style="font-size: 13.57px;">Azure Websites</a> <a href="/tags/BUILD/" style="font-size: 10px;">BUILD</a> <a href="/tags/BitBucket/" style="font-size: 10px;">BitBucket</a> <a href="/tags/Bootstrap/" style="font-size: 15.71px;">Bootstrap</a> <a href="/tags/CTT-NUG/" style="font-size: 10px;">CTT .NUG</a> <a href="/tags/Calgary/" style="font-size: 10px;">Calgary</a> <a href="/tags/Cisco-VPN/" style="font-size: 10px;">Cisco VPN</a> <a href="/tags/ClearMeasure/" style="font-size: 10.71px;">ClearMeasure</a> <a href="/tags/CodeProject/" style="font-size: 11.43px;">CodeProject</a> <a href="/tags/Conferences/" style="font-size: 10.71px;">Conferences</a> <a href="/tags/CouchDb/" style="font-size: 10px;">CouchDb</a> <a href="/tags/DNX/" style="font-size: 10px;">DNX</a> <a href="/tags/Dojo/" style="font-size: 10px;">Dojo</a> <a href="/tags/Email/" style="font-size: 10px;">Email</a> <a href="/tags/Entity-Framework/" style="font-size: 13.57px;">Entity Framework</a> <a href="/tags/Extension-Methods/" style="font-size: 10px;">Extension Methods</a> <a href="/tags/FontAwesome/" style="font-size: 10.71px;">FontAwesome</a> <a href="/tags/GenFu/" style="font-size: 10px;">GenFu</a> <a href="/tags/GetManifestResourceStream/" style="font-size: 10px;">GetManifestResourceStream</a> <a href="/tags/Git/" style="font-size: 11.43px;">Git</a> <a href="/tags/HTML5/" style="font-size: 10px;">HTML5</a> <a href="/tags/HackAThon/" style="font-size: 10px;">HackAThon</a> <a href="/tags/HtmlHelper/" style="font-size: 10px;">HtmlHelper</a> <a href="/tags/IIS/" style="font-size: 10px;">IIS</a> <a href="/tags/JSON/" style="font-size: 10.71px;">JSON</a> <a href="/tags/Keynote/" style="font-size: 10px;">Keynote</a> <a href="/tags/Life-Hack/" style="font-size: 10px;">Life Hack</a> <a href="/tags/Life-Hacking/" style="font-size: 10.71px;">Life Hacking</a> <a href="/tags/Life-Hacks/" style="font-size: 12.14px;">Life Hacks</a> <a href="/tags/Linq/" style="font-size: 10px;">Linq</a> <a href="/tags/MIX11/" style="font-size: 10px;">MIX11</a> <a href="/tags/MVA/" style="font-size: 10.71px;">MVA</a> <a href="/tags/MVC/" style="font-size: 19.29px;">MVC</a> <a href="/tags/MVC5/" style="font-size: 18.57px;">MVC5</a> <a href="/tags/MVC6/" style="font-size: 13.57px;">MVC6</a> <a href="/tags/MVP/" style="font-size: 10px;">MVP</a> <a href="/tags/Make-Code-Not-War/" style="font-size: 10px;">Make Code Not War</a> <a href="/tags/MeasureUp/" style="font-size: 10px;">MeasureUp</a> <a href="/tags/Metro/" style="font-size: 10px;">Metro</a> <a href="/tags/Microsoft/" style="font-size: 10px;">Microsoft</a> <a href="/tags/Microsoft-Band/" style="font-size: 12.14px;">Microsoft Band</a> <a href="/tags/Mobile/" style="font-size: 10px;">Mobile</a> <a href="/tags/Mobile-Services/" style="font-size: 10px;">Mobile Services</a> <a href="/tags/Motivate/" style="font-size: 10px;">Motivate</a> <a href="/tags/MvcScaffolding/" style="font-size: 11.43px;">MvcScaffolding</a> <a href="/tags/Not-Coding-At-All/" style="font-size: 10px;">Not Coding At All</a> <a href="/tags/NuGet/" style="font-size: 15px;">NuGet</a> <a href="/tags/OData/" style="font-size: 10px;">OData</a> <a href="/tags/PayPal/" style="font-size: 10px;">PayPal</a> <a href="/tags/PostSharp/" style="font-size: 10px;">PostSharp</a> <a href="/tags/Practice/" style="font-size: 10.71px;">Practice</a> <a href="/tags/Practice-of-Awesome/" style="font-size: 10px;">Practice of Awesome</a> <a href="/tags/PrairieDevCon/" style="font-size: 16.43px;">PrairieDevCon</a> <a href="/tags/Queues/" style="font-size: 10px;">Queues</a> <a href="/tags/REST/" style="font-size: 10px;">REST</a> <a href="/tags/Radio/" style="font-size: 10px;">Radio</a> <a href="/tags/Razor/" style="font-size: 10.71px;">Razor</a> <a href="/tags/Real-Life/" style="font-size: 10px;">Real Life</a> <a href="/tags/Regina/" style="font-size: 10.71px;">Regina</a> <a href="/tags/Remote-Work/" style="font-size: 10.71px;">Remote Work</a> <a href="/tags/Resolve/" style="font-size: 10px;">Resolve</a> <a href="/tags/Rock-Paper-Scissors/" style="font-size: 10px;">Rock Paper Scissors</a> <a href="/tags/Routing/" style="font-size: 10px;">Routing</a> <a href="/tags/Ruby-on-Rails/" style="font-size: 10px;">Ruby on Rails</a> <a href="/tags/SDEC/" style="font-size: 10px;">SDEC</a> <a href="/tags/SOAP/" style="font-size: 10px;">SOAP</a> <a href="/tags/SQL-Server/" style="font-size: 10px;">SQL Server</a> <a href="/tags/ServiceBus/" style="font-size: 10px;">ServiceBus</a> <a href="/tags/SignalR/" style="font-size: 11.43px;">SignalR</a> <a href="/tags/Speaking/" style="font-size: 11.43px;">Speaking</a> <a href="/tags/TFS/" style="font-size: 10px;">TFS</a> <a href="/tags/Table-Storage/" style="font-size: 10.71px;">Table Storage</a> <a href="/tags/TypeScript/" style="font-size: 10px;">TypeScript</a> <a href="/tags/Unit-Testing/" style="font-size: 10px;">Unit Testing</a> <a href="/tags/Visual-Studio/" style="font-size: 10.71px;">Visual Studio</a> <a href="/tags/Visual-Studio-11/" style="font-size: 11.43px;">Visual Studio 11</a> <a href="/tags/Visual-Studio-2010/" style="font-size: 16.43px;">Visual Studio 2010</a> <a href="/tags/Visual-Studio-2012/" style="font-size: 12.86px;">Visual Studio 2012</a> <a href="/tags/Visual-Studio-2013/" style="font-size: 10.71px;">Visual Studio 2013</a> <a href="/tags/Visual-Studio-2015/" style="font-size: 14.29px;">Visual Studio 2015</a> <a href="/tags/WCF/" style="font-size: 10.71px;">WCF</a> <a href="/tags/Web-API/" style="font-size: 10.71px;">Web API</a> <a href="/tags/Web-Development/" style="font-size: 10px;">Web Development</a> <a href="/tags/Web-Services/" style="font-size: 10.71px;">Web Services</a> <a href="/tags/Windows-8/" style="font-size: 11.43px;">Windows 8</a> <a href="/tags/Windows-Azure/" style="font-size: 10px;">Windows Azure</a> <a href="/tags/Windows-Phone/" style="font-size: 14.29px;">Windows Phone</a> <a href="/tags/Windws-Live-Writer/" style="font-size: 10px;">Windws Live Writer</a> <a href="/tags/Winnipeg/" style="font-size: 10.71px;">Winnipeg</a> <a href="/tags/c/" style="font-size: 11.43px;">c#</a> <a href="/tags/compiling/" style="font-size: 10px;">compiling</a> <a href="/tags/jQuery/" style="font-size: 12.14px;">jQuery</a> <a href="/tags/jQuery-UI/" style="font-size: 10.71px;">jQuery UI</a> <a href="/tags/node/" style="font-size: 10px;">node</a> <a href="/tags/npm/" style="font-size: 10px;">npm</a> <a href="/tags/open-source/" style="font-size: 10.71px;">open source</a> <a href="/tags/reflection/" style="font-size: 10px;">reflection</a> <a href="/tags/seed-data/" style="font-size: 10px;">seed data</a> <a href="/tags/testing/" style="font-size: 10px;">testing</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/">2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/">2015</a><span class="archive-list-count">36</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/">2014</a><span class="archive-list-count">42</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/">2013</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/">2012</a><span class="archive-list-count">41</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/">2011</a><span class="archive-list-count">36</span></li></ul>
    </div>
  </div>

  
  <div id="toTop" class="fa fa-chevron-up"></div>
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 1999 - 2016 James Chambers<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    

<script>
  var disqus_shortname = 'jameschambers';
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>



 <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>




  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>